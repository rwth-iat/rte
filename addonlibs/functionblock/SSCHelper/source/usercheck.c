
/******************************************************************************
 *
 *   FILE
 *   ----
 *   usercheck.c
 *
 *   History
 *   -------
 *   2014-03-31   File created
 *
 *******************************************************************************
 *
 *   This file is generated by the 'acplt_builder' command
 *
 ******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_SSChelper
#define OV_COMPILE_LIBRARY_SSChelper
#endif


#include "SSChelper.h"
#include "libov/ov_macros.h"


OV_DLLFNCEXPORT void SSChelper_usercheck_typemethod(
		OV_INSTPTR_fb_functionblock	pfb,
		OV_TIME						*pltc
) {
	/*
	 *   local variables
	 */
	OV_INSTPTR_SSChelper_usercheck pinst = Ov_StaticPtrCast(SSChelper_usercheck, pfb);

	if(ov_string_compare(pinst->v_user,pinst->v_occupiedby)==OV_STRCMP_EQUAL){
		pinst->v_result=TRUE;
		if(ov_string_compare(pinst->v_order,"FREE")==OV_STRCMP_EQUAL){
			if(pinst->v_lastOccupier && *pinst->v_lastOccupier){
				ov_string_setvalue(&pinst->v_occupiedby,pinst->v_lastOccupier);
			}
			else{
				ov_string_setvalue(&pinst->v_occupiedby,"");
			}
		}
	}else{
		/*	OP overrides all, otherwise do occupy if free	*/
		if(ov_string_compare(pinst->v_order,"OCCUPY")==OV_STRCMP_EQUAL
				&& (ov_string_compare(pinst->v_user,"OP")==OV_STRCMP_EQUAL
						|| !pinst->v_occupiedby || !(*pinst->v_occupiedby))){
			ov_string_setvalue(&pinst->v_occupiedby,pinst->v_user);
			pinst->v_result=TRUE;
		}else{
			pinst->v_result=FALSE;
		}

	}
	return;
}

