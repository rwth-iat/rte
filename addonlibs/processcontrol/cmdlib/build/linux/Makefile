#******************************************************************************
#*
#*   FILE
#*   ----
#*   Makefile - Makefile fuer die Anwender-Bibliothek
#******************************************************************************
#*
#*   This file is generated by the 'fb_makmak' command
#*
#******************************************************************************

#   Plattform
#   ---------

SYSTEM = LINUX
SYSDIR = linux

COMPILER = GNU

#	Filename conventions
#	--------------------
_C   = .c
_OBJ = .o
_LIB = .a
_DLL = .so
_EXE =

#	Include generic part
#	--------------------
include ../generic.mk

all: $(TARGETS)

#	Compiler
#	--------

OV_CODEGEN_EXE = $(BIN_DIR)ov_codegen$(_EXE)
CC			= gcc
CC_FLAGS	= -g -Wall -O2 -shared
CC_DEFINES	= $(DEFINES)
CC_INCLUDES	= $(INCLUDES) -I.
COMPILE_C	= $(CC) $(CC_FLAGS) $(CC_DEFINES) $(CC_INCLUDES) -c
AR			= ar
RANLIB		= ranlib
LD			= ld -shared

#   Rules
#   -----
$(_C)$(_OBJ):
	$(COMPILE_C) -o$@ $<

.ovm$(_C):
	$(OV_CODEGEN_EXE) -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(comlib_MODEL_DIR) -f $< -l $(notdir $(basename $<))

.ovm.h:
	$(OV_CODEGEN_EXE) -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(comlib_MODEL_DIR) -f $< -l $(notdir $(basename $<))

ov.h : $(ACPLT_OV_INCLUDE_DIR)ov.ovm
	$(OV_CODEGEN_EXE) -f $<

fb.h : $(FBS_INCLUDE_DIR)fb.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR)

comlib.h : $(comlib_MODEL_DIR)comlib.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(comlib_MODEL_DIR)

cmdlib.h : $(MODEL_DIR)cmdlib.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(comlib_MODEL_DIR)

$(USERLIB_LIB) : $(USERLIB_OBJ)
	$(AR) rv $@ $^
	$(RANLIB) $@
	@strip --strip-debug $(USERLIB_LIB)

$(USERLIB_DLL) : $(USERLIB_OBJ)
	$(LD) -o $@ $^
	@strip --strip-debug $(USERLIB_LIB)
	cp $@ $(USERLIB_DIR)

#   Dependencies
#   ------------

.depend:
	touch $@

depend : $(SOURCES)
	$(COMPILE_C) -MM $(USERLIB_SRC) > .depend

#	Aufraeumen
#	----------

clean:
	-@rm *$(_C) *.h *.x *$(_LIB) *$(_DLL) *$(_OBJ)
