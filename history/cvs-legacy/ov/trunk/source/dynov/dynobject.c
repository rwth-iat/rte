/*
*   The Framework was generated by the ACPLT/OV Builder.
*
*   Builder version: 1.0.1
*   Date of file generation:  10-Apr-2002 (17:18:25)
*/

#ifndef OV_COMPILE_LIBRARY_dynov
#define OV_COMPILE_LIBRARY_dynov
#endif


#include "dynov.h"
#include "libov/ov_macros.h"
#include "libov/ov_object.h"

OV_DLLFNCEXPORT OV_ACCESS dynov_dynobject_getaccess(
	OV_INSTPTR_ov_object	pobj,
	const OV_ELEMENT		*pelem,
	const OV_TICKET			*pticket
) {
	/*
	*	local variables
	*/
	OV_ACCESS			access;
	OV_INSTPTR_dynov_dynvariable	pdynvar;
	OV_INSTPTR_ov_class	pclass;
	/*
	*	switch based on the element's type
	*/
	switch(pelem->elemtype) {
	case OV_ET_OBJECT:
		/*
		*	all other objects are readable and may be deleteable,
		*	renameable or writeable
		*/
		access = OV_AC_READ;
		pclass = Ov_GetParent(ov_instantiation, pobj);
		if(!pobj->v_pouterobject) {
			access |= OV_AC_RENAMEABLE;
			if(!ov_object_haslinks(pobj)) {
				access |= OV_AC_DELETEABLE;
			}
		}
		if(ov_class_cancastto(pclass, pclass_ov_domain)) {
			access |= OV_AC_WRITE;
		}
		return access;
	case OV_ET_MEMBER:
	case OV_ET_VARIABLE:
		access = OV_AC_NONE;
		if (ov_activitylock) {
			if (!(pelem->elemunion.pvar->v_varprops & (OV_VP_DERIVED | OV_VP_STATIC)))
				access |= OV_AC_READ | OV_AC_WRITE;
			return access;
		}
		if(pelem->elemunion.pvar->v_varprops & OV_VP_GETACCESSOR) {
			access |= OV_AC_READ;
		}
		if((pelem->elemunion.pvar->v_varprops & OV_VP_SETACCESSOR)
			&& ((pobj->v_objectstate & OV_OS_INIT) 
				|| !(pelem->elemunion.pvar->v_varprops & OV_VP_STATIC))
		) {
			access |= OV_AC_WRITE;
		}
		pdynvar = Ov_DynamicPtrCast(dynov_dynvariable, pelem->elemunion.pvar);
		if (pdynvar)  {
			access |= pdynvar->v_accessrights;
		}
		return access;
	case OV_ET_CHILDLINK:
		if (pelem->elemunion.passoc->v_getaccessfnc) 
			return pelem->elemunion.passoc->v_getaccessfnc(NULL, pobj, pticket);
		else return OV_AC_READ;
	case OV_ET_PARENTLINK:
		if (pelem->elemunion.passoc->v_getaccessfnc) 
			return pelem->elemunion.passoc->v_getaccessfnc(pobj, NULL, pticket);
		else return OV_AC_READ;
	case OV_ET_OPERATION:
		return OV_AC_NONE;
	default:
		break;
	}
	return OV_AC_NONE;
}

