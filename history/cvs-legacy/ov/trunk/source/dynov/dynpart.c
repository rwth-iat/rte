/*
*   The Framework was generated by the ACPLT/OV Builder.
*
*   Builder version: 1.0.1
*   Date of file generation:  10-Apr-2002 (17:18:25)
*/

#ifndef OV_COMPILE_LIBRARY_dynov
#define OV_COMPILE_LIBRARY_dynov
#endif


#include "dynov.h"
#include "libov/ov_macros.h"

OV_DLLFNCEXPORT void dynov_dynpart_uncheck(
        OV_INSTPTR_ov_object          pobj
) {
	OV_INSTPTR_dynov_dynpart	pdynpart;
	OV_INSTPTR_ov_class		pclass;

	pdynpart = Ov_DynamicPtrCast(dynov_dynpart, pobj);
	if (pdynpart) {
		pclass = Ov_GetParent(ov_embedment, pdynpart);
		Ov_Unlink(ov_embedment, pclass, pdynpart);
	}
}

OV_DLLFNCEXPORT OV_BOOL dynov_dynpart_check(
        OV_INSTPTR_ov_object          pobj
) {
	OV_INSTPTR_dynov_dynpart	pdynpart;
	OV_INSTPTR_ov_class		pclass;

	pdynpart = Ov_DynamicPtrCast(dynov_dynpart, pobj);
	if (pdynpart) {
		pclass = Ov_GetParent(dynov_dynembedment, pdynpart);
		if (pclass) {
			if (!(pclass->v_classprops & OV_CP_INSTANTIABLE)) return FALSE;
			if (!Ov_Fail(Ov_Link(ov_embedment, pclass, pdynpart))) return TRUE;
		}
	}
	return FALSE;
}

OV_DLLFNCEXPORT OV_ACCESS dynov_dynpart_getaccess(
	OV_INSTPTR_ov_object	pobj,
	const OV_ELEMENT		*pelem,
	const OV_TICKET			*pticket
) {
	OV_INSTPTR_dynov_dynclass	pdynclass;

	OV_ACCESS			access;
	OV_ACCESS			access2;

	pdynclass = Ov_DynamicPtrCast(dynov_dynclass, Ov_GetParent(ov_containment, pobj));
	if (pdynclass) {
  	    switch(pelem->elemtype) {
		case OV_ET_VARIABLE:
			access = OV_AC_NONE;
			if (pdynclass->v_isinstantiable) access = OV_AC_READ;
			else access = OV_AC_READ | OV_AC_WRITE;
			if (!ov_string_compare(pelem->elemunion.pvar->v_identifier, "flags"))
				return access;
			return OV_AC_NONE;
		case OV_ET_CHILDLINK:
			if (pdynclass->v_isinstantiable) {
				access = OV_AC_READ;
				access2 = OV_AC_READ;
			}
			else  {
				access = OV_AC_READ | OV_AC_WRITE;
				access2 = OV_AC_READ;
			}
			if (pelem->elemunion.passoc == passoc_ov_embedment)
				return access2;
			if (pelem->elemunion.passoc == passoc_dynov_dynembedment)
				return access;
			return OV_AC_NONE;
		case OV_ET_PARENTLINK:
			return OV_AC_NONE;
    	    }
	    if ((pdynclass->v_isinstantiable) || (pobj->v_pouterobject)) return OV_AC_READ;
	}
	return OV_AC_READ | OV_AC_DELETEABLE | OV_AC_RENAMEABLE;
}

