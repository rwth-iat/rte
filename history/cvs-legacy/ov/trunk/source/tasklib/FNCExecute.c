/*
*   The Framework was generated by the ACPLT/OV Builder.
*
*   Builder version: 1.0.0
*   Date of file generation:  21-Nov-2001 (10:25:25)
*/

#ifndef OV_COMPILE_LIBRARY_tasklib
#define OV_COMPILE_LIBRARY_tasklib
#endif


#include "tasklib.h"
#include "libov/ov_macros.h"
#include "libov/ov_scheduler.h"
#include "libov/ov_path.h"

/*
*	Makro wrapping the address resolution of a symbol in a DLL/shared library
*/
#if OV_DYNAMIC_LIBRARIES
#if OV_SYSTEM_UNIX
#define Ov_Library_GetAddr(handle, symbolname)	dlsym(handle, symbolname)
#elif OV_SYSTEM_NT
#define Ov_Library_GetAddr(handle, symbolname)	GetProcAddress(handle, symbolname)
#endif
#endif

OV_DLLFNCEXPORT OV_STRING tasklib_FNCExecute_class_get(
             OV_INSTPTR_tasklib_FNCExecute          pobj
) {
	return pobj->v_class;
}

OV_DLLFNCEXPORT OV_STRING tasklib_FNCExecute_lib_get(
             OV_INSTPTR_tasklib_FNCExecute          pobj
) {
	return pobj->v_lib;
}

OV_DLLFNCEXPORT OV_UINT tasklib_FNCExecute_handle_get(
             OV_INSTPTR_tasklib_FNCExecute          pobj
) {
	return pobj->v_handle;
}

OV_DLLFNCEXPORT OV_STRING tasklib_FNCExecute_objectpath_get(
             OV_INSTPTR_tasklib_FNCExecute          pobj
) {
	return pobj->v_objectpath;
}

OV_DLLFNCEXPORT OV_RESULT tasklib_FNCExecute_objectpath_set(
             OV_INSTPTR_tasklib_FNCExecute          pobj,
             const OV_STRING 	          value
) {
	ov_string_setvalue(&pobj->v_objectpath, value);
	return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_STRING tasklib_FNCExecute_fncname_get(
             OV_INSTPTR_tasklib_FNCExecute          pobj
) {
	return pobj->v_fncname;
}

OV_DLLFNCEXPORT OV_RESULT tasklib_FNCExecute_fncname_set(
             OV_INSTPTR_tasklib_FNCExecute          pobj,
             const OV_STRING 	          value
) {
	ov_string_setvalue(&pobj->v_fncname, value);
	return OV_ERR_OK;
}

OV_DLLFNCEXPORT void tasklib_FNCExecute_execute(
	OV_INSTPTR_ov_object pobj
) {
	OV_INSTPTR_tasklib_FNCExecute	       	pfnc;
	OV_INSTPTR_ov_object 			pinst;
	OV_INSTPTR_ov_object 			pchild;
	OV_INSTPTR_ov_class 			pclass;
	OV_INSTPTR_ov_library			plib;
	OV_FNC_EXECUTE				*fncexec = NULL;
	char					tmpstring[256];

	pfnc = Ov_StaticPtrCast(tasklib_FNCExecute, pobj);
	ov_string_setvalue(&pfnc->v_class, "");
	ov_string_setvalue(&pfnc->v_lib, "");
	pfnc->v_handle = 0;
	pinst = ov_path_getobjectpointer(pfnc->v_objectpath, 0);
	pclass=Ov_GetParent(ov_instantiation, pinst);
	while (pclass) {
		pchild = Ov_SearchChild(ov_containment, Ov_PtrUpCast(ov_domain, pclass), pfnc->v_fncname);
		if (pchild) 
			if (Ov_CanCastTo(ov_operation, pchild)) break;
		pclass=Ov_GetParent(ov_inheritance, pclass);
	}
	if (pclass) {
		ov_string_setvalue(&pfnc->v_class, pclass->v_identifier);
		plib=Ov_StaticPtrCast(ov_library,Ov_GetParent(ov_containment, Ov_PtrUpCast(ov_object,pclass)));
		if (plib) {
			ov_string_setvalue(&pfnc->v_lib, plib->v_identifier);
			sprintf(tmpstring, "%s_%s_%s", plib->v_identifier, pclass->v_identifier, pfnc->v_fncname);
			fncexec = (OV_FNC_EXECUTE*)Ov_Library_GetAddr((OV_DLLHANDLE)plib->v_handle, tmpstring);
			pfnc->v_handle = (OV_UINT) fncexec;
			if (fncexec) fncexec(pinst);
		}
	}
}

