
/******************************************************************************
*
*   FILE
*   ----
*   functionchart.c
*
*   History
*   -------
*   2011-06-10   File created
*
*******************************************************************************
*
*   This file is generated by the 'fb_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_fb
#define OV_COMPILE_LIBRARY_fb
#endif


#include "fb.h"
#include "libov/ov_macros.h"
#include "fb_namedef.h"
#include "fb_macros.h"

/*
*	Execute internal task
*/
void fbchart_execIntask(
	OV_INSTPTR_fb_task	pIntask,
	OV_TIME				*pltc
) {
	OV_VTBLPTR_fb_task	             pvtable;
	
	
	Ov_GetVTablePtr(fb_task, pvtable, pIntask);

	if(!pvtable) {
        /* ? */
        return;
    }
    pvtable->m_execute(pIntask, pltc);
}

/*
*	Typemethod of functionchart
*/
OV_DLLFNCEXPORT void fb_functionchart_typemethod(
    OV_INSTPTR_fb_functionblock  pfb,
    OV_TIME                     *pltc
) {
    OV_INSTPTR_fb_task          intask;
    OV_INSTPTR_fb_port          pvar;
    OV_INSTPTR_fb_functionchart pfc = Ov_StaticPtrCast(fb_functionchart, pfb);

    /* Init intask */
    intask = &pfc->p_intask;
    intask->v_actimode = 1;
    intask->v_cyctime.secs = 0;
    intask->v_cyctime.usecs = 0;
    intask->v_proctime = *pltc;
    
    /* Trigger all connections on chart input ports */
    Ov_ForEachChild (fb_variables, pfc, pvar) {
        if( IsFlagSet(pvar->v_flags, 'i') ) {
            fb_object_triggerInpGetConnections( (OV_INSTPTR_fb_object)pvar );
            fb_object_triggerOutSendConnections( (OV_INSTPTR_fb_object)pvar );
        }
    }
  
    /* Execute internal task */
    fbchart_execIntask(intask, pltc);
  
    /* Trigger all connections on chart output ports */
    Ov_ForEachChild (fb_variables, pfc, pvar) {
        if( IsFlagSet(pvar->v_flags, 'o') ) {
            fb_object_triggerInpGetConnections( (OV_INSTPTR_fb_object)pvar );
            fb_object_triggerOutSendConnections( (OV_INSTPTR_fb_object)pvar );
        }
    }    
}
