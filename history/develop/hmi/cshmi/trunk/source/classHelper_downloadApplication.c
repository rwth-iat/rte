
/******************************************************************************
*
*   FILE
*   ----
*   downloadApplication.c
*
*   History
*   -------
*   2013-04-29   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_cshmi
#define OV_COMPILE_LIBRARY_cshmi
#endif

#include "cshmi.h"
#include "cshmilib.h"

/**
 * returns a list of ov_containment
 * embedment/OV_PART is known to the visualisation system
 * @param pObj
 * @param strResult Pointer to the result String
 * @param isFirstEntry if FALSE the function adds an "," as a separator
 * @return
 */
OV_RESULT cshmi_downloadApplication_buildChildList(OV_INSTPTR_ov_object pObj, OV_STRING*strResult, OV_BOOL isFirstEntry){
	OV_INSTPTR_ov_object pChildObj = NULL;
	OV_INSTPTR_cshmi_IfThenElse pIfThenElse = NULL;
	OV_INSTPTR_cshmi_ChildrenIterator pChildrenIterator = NULL;

	//local string to make ov_string functions fast
	OV_STRING strChildList = NULL;

	if(!Ov_CanCastTo(ov_domain, pObj)){
		return OV_ERR_OK;
	}
	if(isFirstEntry == FALSE){
		ov_string_setvalue(&strChildList, ",%22");
	}else{
		ov_string_setvalue(&strChildList, "%22");
	}
	ov_memstack_lock();
	ov_string_append(&strChildList, ov_path_getcanonicalpath(pObj, 2));
	ov_memstack_unlock();
	ov_string_append(&strChildList, "%22:%7B");
	ov_string_append(&strChildList, "%22ChildListParameters%22:[");

	//iterate over all childrens and list them
	Ov_ForEachChild(ov_containment, Ov_StaticPtrCast(ov_domain, pObj), pChildObj){
		ov_string_append(&strChildList, "%22");
		ov_string_append(&strChildList, pChildObj->v_identifier);
		ov_string_append(&strChildList, " ");
		ov_memstack_lock();
		ov_string_append(&strChildList, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, Ov_GetClassPtr(pChildObj)), 2));
		ov_memstack_unlock();
		ov_string_append(&strChildList, "%22");
		if(Ov_GetNextChild(ov_containment, pChildObj) != NULL){
			ov_string_append(&strChildList, ",");
		}
	};
	ov_string_append(&strChildList, "]%7D");

	//one single append to the huge string
	ov_string_append(strResult, strChildList);

	//interesting ov_containment childrens are domains or cshmi objects
	if(		Ov_CanCastTo(cshmi_Object, pObj)
			|| Ov_GetParent(ov_instantiation, pObj)==pclass_ov_domain
			){
		Ov_ForEachChild(ov_containment, Ov_StaticPtrCast(ov_domain, pObj), pChildObj){
			cshmi_downloadApplication_buildChildList(pChildObj, strResult, FALSE);
		}
	}
	//some ov_embedment childrens
	if(Ov_CanCastTo(cshmi_IfThenElse, pObj)){
		pIfThenElse = Ov_StaticPtrCast(cshmi_IfThenElse, pObj);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_if), strResult, FALSE);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_then), strResult, FALSE);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_else), strResult, FALSE);
	}else if(Ov_CanCastTo(cshmi_ChildrenIterator, pObj)){
		pChildrenIterator = Ov_StaticPtrCast(cshmi_ChildrenIterator, pObj);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pChildrenIterator->p_forEachChild), strResult, FALSE);
	}

	ov_string_setvalue(&strChildList, NULL);
	return OV_ERR_OK;
}

/**
 * prints the basic types to the string (visible, stroke, fill, opacity, rotate)
 * @param strResult
 * @param pElement
 * @return
 */
OV_RESULT cshmi_downloadApplication_buildBaseElementString(OV_STRING*strResult, OV_INSTPTR_cshmi_Element pElement){
	ov_string_print(strResult, "%s%%22visible%%22:%%22%s%%22,", *strResult, (pElement->v_visible==TRUE?"TRUE":"FALSE"));
	ov_string_print(strResult, "%s%%22stroke%%22:%%22%s%%22,", *strResult, pElement->v_stroke==NULL?"":pElement->v_stroke);
	ov_string_print(strResult, "%s%%22fill%%22:%%22%s%%22,", *strResult, pElement->v_fill==NULL?"":pElement->v_fill);
	ov_string_print(strResult, "%s%%22opacity%%22:%%22%f%%22,", *strResult, pElement->v_opacity);
	ov_string_print(strResult, "%s%%22rotate%%22:%%22%i%%22,", *strResult, pElement->v_rotate);
	return OV_ERR_OK;
}
OV_RESULT cshmi_downloadApplication_buildElementList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_Template pTemplate = NULL;
	OV_INSTPTR_cshmi_InstantiateTemplate pInstantiateTemplate = NULL;
	OV_INSTPTR_cshmi_Group pGroup = NULL;
	OV_INSTPTR_cshmi_TemplateDefinition pTemplateDefinition = NULL;
	OV_INSTPTR_cshmi_Rectangle pRectangle = NULL;
	OV_INSTPTR_cshmi_Circle pCircle = NULL;
	OV_INSTPTR_cshmi_Text pText = NULL;

	OV_STRING strGroup = " ";
	OV_STRING strTemplateDefinition = " ";
	OV_STRING strTemplate = " ";
	OV_STRING strInstantiateTemplate = " ";
	OV_STRING strRectangle = " ";
	OV_STRING strCircle = " ";
	OV_STRING strText = " ";
	OV_STRING strIterateGroup = NULL;
	OV_STRING strIterateTemplateDefinition = NULL;
	OV_STRING strIterateTemplate = NULL;
	OV_STRING strIterateInstantiateTemplate = NULL;
	OV_STRING strIterateRectangle = NULL;
	OV_STRING strIterateCircle = NULL;
	OV_STRING strIterateText = NULL;

	OV_STRING temp = NULL;
	OV_UINT i = 0;
	OV_BOOL elementInstantiated = FALSE;
	OV_BOOL elementIsfirst = TRUE;
	OV_STRING_VEC ResultListVec = {0, NULL};
	OV_STRING ResultFormat = NULL;

	ov_string_setvalue(&ResultFormat, "%s");
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Group, pObj){
		elementInstantiated = TRUE;
		pGroup = Ov_StaticPtrCast(cshmi_Group, pObj);
		ov_string_setvalue(&strIterateGroup, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateGroup, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateGroup, "%22:%7B");
		ov_string_append(&strIterateGroup, "%22Parameters%22:%7B");
		ov_string_print(&strIterateGroup, "%s%%22x%%22:%%22%f%%22,", strIterateGroup, pGroup->v_x);
		ov_string_print(&strIterateGroup, "%s%%22y%%22:%%22%f%%22,", strIterateGroup, pGroup->v_y);
		ov_string_print(&strIterateGroup, "%s%%22width%%22:%%22%f%%22,", strIterateGroup, pGroup->v_width);
		ov_string_print(&strIterateGroup, "%s%%22height%%22:%%22%f%%22,", strIterateGroup, pGroup->v_height);
		ov_string_print(&strIterateGroup, "%s%%22hideable%%22:%%22%s%%22,", strIterateGroup, (pGroup->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_print(&strIterateGroup, "%s%%22visible%%22:%%22%s%%22", strIterateGroup, (pGroup->v_visible==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterateGroup, "%7D");
		ov_string_append(&strIterateGroup, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateGroup, ",");
		}
		ov_string_append(&strGroup, strIterateGroup);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strGroup;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_TemplateDefinition, pObj){
		elementInstantiated = TRUE;
		pTemplateDefinition = Ov_StaticPtrCast(cshmi_TemplateDefinition, pObj);
		ov_string_append(&strIterateTemplateDefinition, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateTemplateDefinition, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateTemplateDefinition, "%22:%7B");
		ov_string_append(&strIterateTemplateDefinition, "%22Parameters%22:%7B");
		ov_string_print(&strIterateTemplateDefinition, "%s%%22width%%22:%%22%f%%22,", strIterateTemplateDefinition, pTemplateDefinition->v_width);
		ov_string_print(&strIterateTemplateDefinition, "%s%%22height%%22:%%22%f%%22", strIterateTemplateDefinition, pTemplateDefinition->v_height);
		ov_string_append(&strIterateTemplateDefinition, "%7D");
		ov_string_append(&strIterateTemplateDefinition, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateTemplateDefinition, ",");
		}
		ov_string_append(&strTemplateDefinition, strIterateTemplateDefinition);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strTemplateDefinition;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Template, pObj){
		elementInstantiated = TRUE;
		pTemplate = Ov_StaticPtrCast(cshmi_Template, pObj);
		ov_string_setvalue(&strIterateTemplate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateTemplate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateTemplate, "%22:%7B");
		ov_string_append(&strIterateTemplate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterateTemplate, Ov_PtrUpCast(cshmi_Element, pTemplate));
		ov_string_print(&strIterateTemplate, "%s%%22TemplateDefinition%%22:%%22%s%%22,", strIterateTemplate, ov_string_compare(pTemplate->v_TemplateDefinition, "")==OV_STRCMP_EQUAL?"":pTemplate->v_TemplateDefinition);
		ov_string_print(&strIterateTemplate, "%s%%22x%%22:%%22%f%%22,", strIterateTemplate, pTemplate->v_x);
		ov_string_print(&strIterateTemplate, "%s%%22y%%22:%%22%f%%22,", strIterateTemplate, pTemplate->v_y);

		ov_string_print(&strIterateTemplate, "%s%%22FBReference%%22:%%22%s%%22,", strIterateTemplate, (pTemplate->v_FBReference.veclen!=1||ov_string_compare(pTemplate->v_FBReference.value[0], "")==OV_STRCMP_EQUAL)?"":pTemplate->v_FBReference.value[0]);

		if(pTemplate->v_FBVariableReference.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pTemplate->v_FBVariableReference.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pTemplate->v_FBVariableReference.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pTemplate->v_FBVariableReference.value[0]);
			for(i = 1; i < pTemplate->v_FBVariableReference.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pTemplate->v_FBVariableReference.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterateTemplate, "%s%%22FBVariableReference%%22:%s,", strIterateTemplate, temp);

		if(pTemplate->v_ConfigValues.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pTemplate->v_ConfigValues.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pTemplate->v_ConfigValues.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pTemplate->v_ConfigValues.value[0]);
			for(i = 1; i < pTemplate->v_ConfigValues.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pTemplate->v_ConfigValues.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterateTemplate, "%s%%22ConfigValues%%22:%s,", strIterateTemplate, temp);

		ov_string_print(&strIterateTemplate, "%s%%22hideable%%22:%%22%s%%22", strIterateTemplate, (pTemplate->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterateTemplate, "%7D");
		ov_string_append(&strIterateTemplate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateTemplate, ",");
		}
		ov_string_append(&strTemplate, strIterateTemplate);
	};
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strTemplate;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_InstantiateTemplate, pObj){
		elementInstantiated = TRUE;
		pInstantiateTemplate = Ov_StaticPtrCast(cshmi_InstantiateTemplate, pObj);
		ov_string_setvalue(&strIterateInstantiateTemplate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateInstantiateTemplate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateInstantiateTemplate, "%22:%7B");
		ov_string_append(&strIterateInstantiateTemplate, "%22Parameters%22:%7B");
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22visible%%22:%%22%s%%22,", strIterateInstantiateTemplate, (pInstantiateTemplate->v_visible==TRUE?"TRUE":"FALSE"));
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22stroke%%22:%%22%s%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_stroke==NULL?"":pInstantiateTemplate->v_stroke);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22fill%%22:%%22%s%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_fill==NULL?"":pInstantiateTemplate->v_fill);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22opacity%%22:%%22%f%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_opacity);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22rotate%%22:%%22%i%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_rotate);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22TemplateDefinition%%22:%%22%s%%22,", strIterateInstantiateTemplate, ov_string_compare(pInstantiateTemplate->v_TemplateDefinition, "")==OV_STRCMP_EQUAL?"":pInstantiateTemplate->v_TemplateDefinition);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22x%%22:%%22%f%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_x);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22y%%22:%%22%f%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_y);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22xOffset%%22:%%22%f%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_xOffset);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22yOffset%%22:%%22%f%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_yOffset);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22maxTemplatesPerDirection%%22:%%22%f%%22,", strIterateInstantiateTemplate, pInstantiateTemplate->v_maxTemplatesPerDirection);
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22FBReference%%22:%%22%s%%22,", strIterateInstantiateTemplate, (pInstantiateTemplate->v_FBReference.veclen!=1||ov_string_compare(pInstantiateTemplate->v_FBReference.value[0], "")==OV_STRCMP_EQUAL)?"":pInstantiateTemplate->v_FBReference.value[0]);

		if(pInstantiateTemplate->v_FBVariableReference.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pInstantiateTemplate->v_FBVariableReference.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pInstantiateTemplate->v_FBVariableReference.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pInstantiateTemplate->v_FBVariableReference.value[0]);
			for(i = 1; i < pInstantiateTemplate->v_FBVariableReference.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pInstantiateTemplate->v_FBVariableReference.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22FBVariableReference%%22:%s,", strIterateInstantiateTemplate, temp);

		if(pTemplate->v_ConfigValues.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pTemplate->v_ConfigValues.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pTemplate->v_ConfigValues.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pTemplate->v_ConfigValues.value[0]);
			for(i = 1; i < pTemplate->v_ConfigValues.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pTemplate->v_ConfigValues.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterateInstantiateTemplate, "%s%%22ConfigValues%%22:%s,", strIterateInstantiateTemplate, temp);

		ov_string_print(&strIterateInstantiateTemplate, "%s%%22hideable%%22:%%22%s%%22", strIterateInstantiateTemplate, (pInstantiateTemplate->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterateInstantiateTemplate, "%7D");
		ov_string_append(&strIterateInstantiateTemplate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateInstantiateTemplate, ",");
		}
		ov_string_append(&strInstantiateTemplate, strIterateInstantiateTemplate);
	};
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strInstantiateTemplate;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Rectangle, pObj){
		elementInstantiated = TRUE;
		pRectangle = Ov_StaticPtrCast(cshmi_Rectangle, pObj);
		ov_string_setvalue(&strIterateRectangle, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateRectangle, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateRectangle, "%22:%7B");
		ov_string_append(&strIterateRectangle, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterateRectangle, Ov_PtrUpCast(cshmi_Element, pRectangle));
		ov_string_print(&strIterateRectangle, "%s%%22x%%22:%%22%f%%22,", strIterateRectangle, pRectangle->v_x);
		ov_string_print(&strIterateRectangle, "%s%%22y%%22:%%22%f%%22,", strIterateRectangle, pRectangle->v_y);
		ov_string_print(&strIterateRectangle, "%s%%22width%%22:%%22%f%%22,", strIterateRectangle, pRectangle->v_width);
		ov_string_print(&strIterateRectangle, "%s%%22height%%22:%%22%f%%22,", strIterateRectangle, pRectangle->v_height);
		ov_string_print(&strIterateRectangle, "%s%%22strokeWidth%%22:%%22%f%%22", strIterateRectangle, pRectangle->v_strokeWidth);
		ov_string_append(&strIterateRectangle, "%7D");
		ov_string_append(&strIterateRectangle, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateRectangle, ",");
		}
		ov_string_append(&strRectangle, strIterateRectangle);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strRectangle;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Circle, pObj){
		elementInstantiated = TRUE;
		pCircle = Ov_StaticPtrCast(cshmi_Circle, pObj);
		ov_string_setvalue(&strIterateCircle, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateCircle, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateCircle, "%22:%7B");
		ov_string_append(&strIterateCircle, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterateCircle, Ov_PtrUpCast(cshmi_Element, pCircle));
		ov_string_print(&strIterateCircle, "%s%%22cx%%22:%%22%f%%22,", strIterateCircle, pCircle->v_cx);
		ov_string_print(&strIterateCircle, "%s%%22cy%%22:%%22%f%%22,", strIterateCircle, pCircle->v_cy);
		ov_string_print(&strIterateCircle, "%s%%22r%%22:%%22%f%%22,", strIterateCircle, pCircle->v_r);
		ov_string_print(&strIterateCircle, "%s%%22strokeWidth%%22:%%22%f%%22", strIterateCircle, pCircle->v_strokeWidth);
		ov_string_append(&strIterateCircle, "%7D");
		ov_string_append(&strIterateCircle, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateCircle, ",");
		}
		ov_string_append(&strCircle, strIterateCircle);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strCircle;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Text, pObj){
		elementInstantiated = TRUE;
		pText = Ov_StaticPtrCast(cshmi_Text, pObj);
		ov_string_setvalue(&strIterateText, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateText, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateText, "%22:%7B");
		ov_string_append(&strIterateText, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterateText, Ov_PtrUpCast(cshmi_Element, pText));
		ov_string_print(&strIterateText, "%s%%22x%%22:%%22%f%%22,", strIterateText, pText->v_x);
		ov_string_print(&strIterateText, "%s%%22y%%22:%%22%f%%22,", strIterateText, pText->v_y);
		ov_string_print(&strIterateText, "%s%%22content%%22:%%22%s%%22,", strIterateText, pText->v_content==NULL?"":pText->v_content);
		ov_string_print(&strIterateText, "%s%%22fontSize%%22:%%22%s%%22,", strIterateText, pText->v_fontSize==NULL?"":pText->v_fontSize);
		ov_string_print(&strIterateText, "%s%%22fontStyle%%22:%%22%s%%22,", strIterateText, pText->v_fontStyle==NULL?"":pText->v_fontStyle);
		ov_string_print(&strIterateText, "%s%%22fontWeight%%22:%%22%s%%22,", strIterateText, pText->v_fontWeight==NULL?"":pText->v_fontWeight);
		ov_string_print(&strIterateText, "%s%%22fontFamily%%22:%%22%s%%22,", strIterateText, pText->v_fontFamily==NULL?"":pText->v_fontFamily);
		ov_string_print(&strIterateText, "%s%%22horAlignment%%22:%%22%s%%22,", strIterateText, pText->v_horAlignment==NULL?"":pText->v_horAlignment);
		ov_string_print(&strIterateText, "%s%%22verAlignment%%22:%%22%s%%22,", strIterateText, pText->v_verAlignment==NULL?"":pText->v_verAlignment);
		ov_string_print(&strIterateText, "%s%%22trimToLength%%22:%%22%i%%22", strIterateText, pText->v_trimToLength);
		ov_string_append(&strIterateText, "%7D");
		ov_string_append(&strIterateText, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateText, ",");
		}
		ov_string_append(&strText, strIterateText);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strText;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	//concat the result, manual for performance reasons (append is not cheap)
	ov_string_print(strResult, ResultFormat, *strResult, ResultListVec.value[0], ResultListVec.value[1], ResultListVec.value[2], ResultListVec.value[3], ResultListVec.value[4], ResultListVec.value[5], ResultListVec.value[6]);
	for(i = 0;i<ResultListVec.veclen;i++){
		//kill the pointer, so Ov_SetDynamicVectorLength will not free the string content
		ResultListVec.value[i] = NULL;
	}
	ov_string_setvalue(&ResultFormat, NULL);
	//free the memory used for the vector
	Ov_SetDynamicVectorLength(&ResultListVec, 0, STRING);


	ov_string_setvalue(&temp, NULL);

	ov_string_setvalue(&strCircle, NULL);
	ov_string_setvalue(&strGroup, NULL);
	ov_string_setvalue(&strInstantiateTemplate, NULL);
	ov_string_setvalue(&strRectangle, NULL);
	ov_string_setvalue(&strTemplate, NULL);
	ov_string_setvalue(&strTemplateDefinition, NULL);
	ov_string_setvalue(&strText, NULL);
	ov_string_setvalue(&strIterateCircle, NULL);
	ov_string_setvalue(&strIterateGroup, NULL);
	ov_string_setvalue(&strIterateInstantiateTemplate, NULL);
	ov_string_setvalue(&strIterateRectangle, NULL);
	ov_string_setvalue(&strIterateTemplate, NULL);
	ov_string_setvalue(&strIterateTemplateDefinition, NULL);
	ov_string_setvalue(&strIterateText, NULL);
	return OV_ERR_OK;
}

/**
 *
 * @param strResult
 * @return
 */
OV_RESULT cshmi_downloadApplication_buildActionList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_SetValue pSetValue = NULL;
	OV_INSTPTR_cshmi_GetValue pGetValue = NULL;
	OV_INSTPTR_cshmi_ChildrenIterator pChildrenIterator = NULL;
	OV_INSTPTR_cshmi_IfThenElse pIfThenElse = NULL;

	OV_STRING strSetValue = " ";
	OV_STRING strGetValue = " ";
	OV_STRING strChildrenIterator = " ";
	OV_STRING strIfThenElse = " ";
	OV_STRING strIterateSetValue = NULL;
	OV_STRING strIterateGetValue = NULL;
	OV_STRING strIterateChildrenIterator = NULL;
	OV_STRING strIterateIfThenElse = NULL;

	OV_STRING ParameterName = NULL;
	OV_STRING ParameterValue = NULL;
	OV_BOOL elementInstantiated = FALSE;
	OV_BOOL elementIsfirst = TRUE;
	OV_UINT i = 0;
	OV_STRING_VEC ResultListVec = {0, NULL};
	OV_STRING ResultFormat = NULL;

	ov_string_setvalue(&ResultFormat, "%s");
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_SetValue, pObj){
		elementInstantiated = TRUE;
		pSetValue = Ov_StaticPtrCast(cshmi_SetValue, pObj);
		ov_string_setvalue(&strIterateSetValue, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateSetValue, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateSetValue, "%22:%7B");

		if(ov_string_compare(pSetValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_ksVar);
		}else if(ov_string_compare(pSetValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_elemVar);
		}else if(ov_string_compare(pSetValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_globalVar);
		}else if(ov_string_compare(pSetValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pSetValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pSetValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pSetValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, NULL);
			ov_string_setvalue(&ParameterValue, NULL);
		}
		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterateSetValue, "%s%%22ParameterName%%22:%%22%s%%22,", strIterateSetValue, ParameterName);
		}else{
			ov_string_print(&strIterateSetValue, "%s%%22ParameterName%%22:%%22%%22,", strIterateSetValue);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterateSetValue, "%s%%22ParameterValue%%22:%%22%s%%22", strIterateSetValue, ParameterValue);
		}else{
			ov_string_print(&strIterateSetValue, "%s%%22ParameterValue%%22:%%22%%22", strIterateSetValue);
		}
		ov_string_append(&strIterateSetValue, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateSetValue, ",");
		}
		ov_string_append(&strSetValue, strIterateSetValue);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strSetValue;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_GetValue, pObj){
		elementInstantiated = TRUE;
		pGetValue = Ov_StaticPtrCast(cshmi_GetValue, pObj);
		if(ov_string_compare(pGetValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_ksVar);
		}else if(ov_string_compare(pGetValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_elemVar);
		}else if(ov_string_compare(pGetValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_globalVar);
		}else if(ov_string_compare(pGetValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pGetValue->v_OperatorInput, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "OperatorInput");
			ov_string_setvalue(&ParameterValue, pGetValue->v_OperatorInput);
		}else if(ov_string_compare(pGetValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pGetValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pGetValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, "value");
			switch (pGetValue->v_value.value.vartype) {
				case OV_VT_STRING_PV:
					ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string);
					break;
				case OV_VT_BOOL_PV:
					ov_string_print(&ParameterValue, "%s", (pGetValue->v_value.value.valueunion.val_bool==TRUE?"TRUE":"FALSE"));
					break;
				case OV_VT_INT_PV:
					ov_string_print(&ParameterValue, "%i", pGetValue->v_value.value.valueunion.val_int);
					break;
				case OV_VT_UINT_PV:
					ov_string_print(&ParameterValue, "%u", pGetValue->v_value.value.valueunion.val_uint);
					break;
				case OV_VT_DOUBLE_PV:
					ov_string_print(&ParameterValue, "%lf", pGetValue->v_value.value.valueunion.val_double);
					break;
				case OV_VT_STRING_PV_VEC:
					if(pGetValue->v_value.value.valueunion.val_string_vec.veclen==0){
						ov_string_setvalue(&ParameterValue, NULL);
					}else if(pGetValue->v_value.value.valueunion.val_string_vec.veclen==1){
						ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[0]);
					}else{
						ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[0]);
						for ( i = 1; i < pGetValue->v_value.value.valueunion.val_string_vec.veclen;i++){
							ov_string_print(&ParameterValue, "%s %s", ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[i]);
						}
					}
					break;
				case OV_VT_VOID:
					ov_string_setvalue(&ParameterValue, NULL);
					break;
				default:
					//The format of the value is not supported, so skip this precaching of the element
					continue;
			}
		}
		ov_string_setvalue(&strIterateGetValue, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateGetValue, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateGetValue, "%22:%7B");

		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterateGetValue, "%s%%22ParameterName%%22:%%22%s%%22,", strIterateGetValue, ParameterName);
		}else{
			ov_string_print(&strIterateGetValue, "%s%%22ParameterName%%22:%%22%%22,", strIterateGetValue);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterateGetValue, "%s%%22ParameterValue%%22:%%22%s%%22", strIterateGetValue, ParameterValue);
		}else{
			ov_string_print(&strIterateGetValue, "%s%%22ParameterValue%%22:%%22%%22", strIterateGetValue);
		}
		ov_string_append(&strIterateGetValue, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateGetValue, ",");
		}
		ov_string_append(&strGetValue, strIterateGetValue);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strGetValue;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_ChildrenIterator, pObj){
		elementInstantiated = TRUE;
		pChildrenIterator = Ov_StaticPtrCast(cshmi_ChildrenIterator, pObj);
		ov_string_setvalue(&strIterateChildrenIterator, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateChildrenIterator, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateChildrenIterator, "%22:%7B");
		ov_string_print(&strIterateChildrenIterator, "%s%%22ChildrenIteratorParameterChildrenType%%22:%%22%s%%22", strIterateChildrenIterator, pChildrenIterator->v_ChildrenType);
		ov_string_append(&strIterateChildrenIterator, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateChildrenIterator, ",");
		}
		ov_string_append(&strChildrenIterator, strIterateChildrenIterator);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strChildrenIterator;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_IfThenElse, pObj){
		elementInstantiated = TRUE;
		pIfThenElse = Ov_StaticPtrCast(cshmi_IfThenElse, pObj);
		ov_string_setvalue(&strIterateIfThenElse, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateIfThenElse, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateIfThenElse, "%22:%7B");
		ov_string_print(&strIterateIfThenElse, "%s%%22IfThenElseParameterAnycond%%22:%%22%s%%22", strIterateIfThenElse, (pIfThenElse->v_anycond==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterateIfThenElse, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateIfThenElse, ",");
		}
		ov_string_append(&strIfThenElse, strIterateIfThenElse);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strIfThenElse;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	//concat the result, manual for performance reasons (append is not cheap)
	ov_string_print(strResult, ResultFormat, *strResult, ResultListVec.value[0], ResultListVec.value[1], ResultListVec.value[2], ResultListVec.value[3]);
	for(i = 0;i<ResultListVec.veclen;i++){
		//kill the pointer, so Ov_SetDynamicVectorLength will not free the string content
		ResultListVec.value[i] = NULL;
	}
	ov_string_setvalue(&ResultFormat, NULL);
	//free the memory used for the vector
	Ov_SetDynamicVectorLength(&ResultListVec, 0, STRING);

	ov_string_print(&strChildrenIterator, NULL);
	ov_string_print(&strGetValue, NULL);
	ov_string_print(&strIfThenElse, NULL);
	ov_string_print(&strSetValue, NULL);
	ov_string_print(&strIterateChildrenIterator, NULL);
	ov_string_print(&strIterateGetValue, NULL);
	ov_string_print(&strIterateIfThenElse, NULL);
	ov_string_print(&strIterateSetValue, NULL);

	return OV_ERR_OK;
}


OV_RESULT cshmi_downloadApplication_buildConditionList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_Compare pCompare = NULL;
	OV_INSTPTR_cshmi_CompareIteratedChild pCompareIteratedChild = NULL;

	OV_STRING strCompare = " ";
	OV_STRING strCompareIteratedChild = " ";
	OV_STRING strIterateCompare = NULL;
	OV_STRING strIterateCompareIteratedChild = NULL;

	OV_STRING_VEC ResultListVec = {0, NULL};
	OV_STRING ResultFormat = NULL;

	OV_BOOL elementInstantiated = FALSE;
	OV_BOOL elementIsfirst = TRUE;
	OV_UINT i = 0;

	ov_string_setvalue(&ResultFormat, "%s");
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Compare, pObj){
		elementInstantiated = TRUE;
		pCompare = Ov_StaticPtrCast(cshmi_Compare, pObj);
		ov_string_setvalue(&strIterateCompare, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateCompare, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateCompare, "%22:%7B");
		ov_string_append(&strIterateCompare, "%22Parameters%22:%7B");
		ov_string_print(&strIterateCompare, "%s%%22comptype%%22:%%22%s%%22,", strIterateCompare, pCompare->v_comptype);
		ov_string_print(&strIterateCompare, "%s%%22ignoreError%%22:%%22%s%%22", strIterateCompare, (pCompare->v_ignoreError==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterateCompare, "%7D");
		ov_string_append(&strIterateCompare, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateCompare, ",");
		}
		ov_string_append(&strCompare, strIterateCompare);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strCompare;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_CompareIteratedChild, pObj){
		elementInstantiated = TRUE;
		pCompareIteratedChild = Ov_StaticPtrCast(cshmi_CompareIteratedChild, pObj);
		ov_string_setvalue(&strIterateCompareIteratedChild, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterateCompareIteratedChild, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterateCompareIteratedChild, "%22:%7B");
		ov_string_append(&strIterateCompareIteratedChild, "%22Parameters%22:%7B");

		ov_string_print(&strIterateCompareIteratedChild, "%s%%22comptype%%22:%%22%s%%22,", strIterateCompareIteratedChild, pCompareIteratedChild->v_comptype);
		ov_string_print(&strIterateCompareIteratedChild, "%s%%22childValue%%22:%%22%s%%22,", strIterateCompareIteratedChild, pCompareIteratedChild->v_childValue);
		ov_string_print(&strIterateCompareIteratedChild, "%s%%22ignoreError%%22:%%22%s%%22", strIterateCompareIteratedChild, (pCompareIteratedChild->v_ignoreError==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterateCompareIteratedChild, "%7D");
		ov_string_append(&strIterateCompareIteratedChild, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterateCompareIteratedChild, ",");
		}
		ov_string_append(&strCompareIteratedChild, strIterateCompareIteratedChild);
	}
	if(elementInstantiated == TRUE){
		Ov_SetDynamicVectorLength(&ResultListVec, ResultListVec.veclen+1, STRING);
		//remembering the pointer to the string! No information is moved!
		ResultListVec.value[ResultListVec.veclen-1] = strCompareIteratedChild;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	//concat the result, manual for performance reasons (append is not cheap)
	ov_string_print(strResult, ResultFormat, *strResult, ResultListVec.value[0], ResultListVec.value[1]);
	for(i = 0;i<ResultListVec.veclen;i++){
		//kill the pointer, so Ov_SetDynamicVectorLength will not free the string content
		ResultListVec.value[i] = NULL;
	}
	ov_string_setvalue(&ResultFormat, NULL);
	//free the memory used for the vector
	Ov_SetDynamicVectorLength(&ResultListVec, 0, STRING);

	//free the memory used for the strings
	ov_string_setvalue(&strCompare, NULL);
	ov_string_setvalue(&strCompareIteratedChild, NULL);
	ov_string_setvalue(&strIterateCompare, NULL);
	ov_string_setvalue(&strIterateCompareIteratedChild, NULL);

	return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_STRING cshmi_downloadApplication_asJSON_get(
    OV_INSTPTR_cshmi_downloadApplication          pThis
) {
	OV_INSTPTR_ov_object pObj = NULL;
	OV_STRING returnString;
	OV_STRING strResult = NULL;
	OV_STRING strElements = NULL;
	OV_STRING strActions = NULL;
	OV_STRING strConditions = NULL;
	OV_STRING strChildList = NULL;
	OV_STRING strBaseKsPath = NULL;

	OV_TIME lasttime;
	OV_TIME thistime;
	OV_TIME_SPAN diff;
	OV_RESULT result = OV_ERR_OK;
	//fixme check every result

	pObj = ov_path_getobjectpointer("/TechUnits/cshmi", 2);
	if(pObj == NULL || !Ov_CanCastTo(ov_domain, pObj)){
		return (OV_STRING) 0;
	}

	/**
	 * Umsetzungstabelle für decodeURI
	 * " %22
	 * { %7B
	 * } %7D
	 * [ %5B
	 * ] %5D
	 * ( (
	 * ) )
	 * + +
	 */

	/**
	 * Tools:
	 * http://meyerweb.com/eric/tools/dencoder/
	 * http://jsonviewer.stack.hu/
	 * http://jsonlint.com/
	 */

	//todo
	//some static baseKsPath settings
	result = ov_string_setvalue(&strBaseKsPath, "%22baseKsPath%22:%7B%22/TechUnits/cshmi%22:[],%22/TechUnits/cshmi/Templates%22:[]%7D,");

	ov_time_gettime(&lasttime);

	//Elements is a list of configured elements
	ov_string_setvalue(&strElements, "%22Elements%22:%7B");
	result = cshmi_downloadApplication_buildElementList(&strElements);
	ov_string_append(&strElements, "%7D,");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Elements: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Elementlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
	}

	//Actions is a list of actions, set/get stores the result only
	ov_string_setvalue(&strActions, "%22Actions%22:%7B");
	result = cshmi_downloadApplication_buildActionList(&strActions);
	ov_string_append(&strActions, "%7D,");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Actions: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Actionlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
	}

	//todo merge conditions with actions
	//Conditions saves all conditions
	ov_string_setvalue(&strConditions, "%22Conditions%22:%7B");
	result = cshmi_downloadApplication_buildConditionList(&strConditions);
	ov_string_append(&strConditions, "%7D,");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Conditions: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Conditionlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
	}

	//ChildList is a list of ov_containment
	ov_string_setvalue(&strChildList, "%22ChildList%22:%7B");
	result = cshmi_downloadApplication_buildChildList(pObj, &strChildList, TRUE);
	ov_string_append(&strChildList, "%7D");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Childlist: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	//todo 2mbyte mb scheint für den testcase zu klein. also vergrößern
	//ändern in memstack, also heap
	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Childlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
	}

	//open JSON Element, concat Strings and close JSON Element
	result = ov_string_print(&strResult, "%%7B%s%s%s%s%s%%7D", strBaseKsPath, strElements, strActions, strConditions, strChildList);


	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error concatting result: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
	}else{
		returnString = (OV_STRING) ov_memstack_alloc(ov_path_percentsize(strResult));
		strcpy(returnString, strResult);
		ov_string_setvalue(&strResult, NULL);
		ov_string_setvalue(&strBaseKsPath, NULL);
		ov_string_setvalue(&strActions, NULL);
		ov_string_setvalue(&strChildList, NULL);
		ov_string_setvalue(&strConditions, NULL);
		ov_string_setvalue(&strElements, NULL);
		return returnString;
	}
	ov_string_setvalue(&strResult, NULL);
	ov_string_setvalue(&strBaseKsPath, NULL);
	ov_string_setvalue(&strActions, NULL);
	ov_string_setvalue(&strChildList, NULL);
	ov_string_setvalue(&strConditions, NULL);
	ov_string_setvalue(&strElements, NULL);
	return (OV_STRING) 0;
}
