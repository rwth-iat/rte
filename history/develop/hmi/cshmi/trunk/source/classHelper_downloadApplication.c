
/******************************************************************************
*
*   FILE
*   ----
*   downloadApplication.c
*
*   History
*   -------
*   2013-04-29   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_cshmi
#define OV_COMPILE_LIBRARY_cshmi
#endif

#include "cshmi.h"
#include "cshmilib.h"

/**
 * returns a list of ov_containment
 * embedment/OV_PART is known to the visualisation system
 * @param pObj
 * @param strResult Pointer to the result String
 * @param isFirstEntry if FALSE the function adds an "," as a separator
 * @return
 */
OV_BOOL cshmi_downloadApplication_buildChildList(OV_INSTPTR_ov_object pObj, OV_STRING*strResult, OV_BOOL isFirstEntry){
	OV_INSTPTR_ov_object pChildObj = NULL;
	OV_INSTPTR_cshmi_IfThenElse pIfThenElse = NULL;
	OV_INSTPTR_cshmi_ChildrenIterator pChildrenIterator = NULL;

	if(!Ov_CanCastTo(ov_domain, pObj)){
		return OV_ERR_OK;
	}
	if(isFirstEntry == FALSE){
		ov_string_append(strResult, ",");
	}

	ov_string_append(strResult, "%22");
	ov_memstack_lock();
	ov_string_append(strResult, ov_path_getcanonicalpath(pObj, 2));
	ov_memstack_unlock();
	ov_string_append(strResult, "%22:%7B");
	ov_string_append(strResult, "%22ChildListParameters%22:[");

	//iterate over all childrens and list them
	Ov_ForEachChild(ov_containment, Ov_StaticPtrCast(ov_domain, pObj), pChildObj){
		ov_string_append(strResult, "%22");
		ov_string_append(strResult, pChildObj->v_identifier);
		ov_string_append(strResult, " ");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, Ov_GetClassPtr(pChildObj)), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22");
		if(Ov_GetNextChild(ov_containment, pChildObj) != NULL){
			ov_string_append(strResult, ",");
		}
	};
	ov_string_append(strResult, "]%7D");

	//interesting ov_containment childrens are domains or cshmi objects
	if(		Ov_CanCastTo(cshmi_Object, pObj)
			|| Ov_GetParent(ov_instantiation, pObj)==pclass_ov_domain
			){
		Ov_ForEachChild(ov_containment, Ov_StaticPtrCast(ov_domain, pObj), pChildObj){
			cshmi_downloadApplication_buildChildList(pChildObj, strResult, FALSE);
		}
	}
	//some ov_embedment childrens
	if(Ov_CanCastTo(cshmi_IfThenElse, pObj)){
		pIfThenElse = Ov_StaticPtrCast(cshmi_IfThenElse, pObj);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_if), strResult, FALSE);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_then), strResult, FALSE);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_else), strResult, FALSE);
	}else if(Ov_CanCastTo(cshmi_ChildrenIterator, pObj)){
		pChildrenIterator = Ov_StaticPtrCast(cshmi_ChildrenIterator, pObj);
		cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pChildrenIterator->p_forEachChild), strResult, FALSE);
	}
	return OV_ERR_OK;
}

/**
 * prints the basic types to the string (visible, stroke, fill, opacity, rotate)
 * @param strResult
 * @param pElement
 * @return
 */
OV_BOOL cshmi_downloadApplication_buildBaseElementString(OV_STRING*strResult, OV_INSTPTR_cshmi_Element pElement){
	ov_string_print(strResult, "%s%%22visible%%22:%%22%s%%22,", *strResult, (pElement->v_visible==TRUE?"TRUE":"FALSE"));
	ov_string_print(strResult, "%s%%22stroke%%22:%%22%s%%22,", *strResult, pElement->v_stroke==NULL?"":pElement->v_stroke);
	ov_string_print(strResult, "%s%%22fill%%22:%%22%s%%22,", *strResult, pElement->v_fill==NULL?"":pElement->v_fill);
	ov_string_print(strResult, "%s%%22opacity%%22:%%22%f%%22,", *strResult, pElement->v_opacity);
	ov_string_print(strResult, "%s%%22rotate%%22:%%22%i%%22,", *strResult, pElement->v_rotate);
	return OV_ERR_OK;
}
OV_BOOL cshmi_downloadApplication_buildElementList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_Template pTemplate = NULL;
	OV_INSTPTR_cshmi_InstantiateTemplate pInstantiateTemplate = NULL;
	OV_INSTPTR_cshmi_Group pGroup = NULL;
	OV_INSTPTR_cshmi_TemplateDefinition pTemplateDefinition = NULL;
	OV_INSTPTR_cshmi_Rectangle pRectangle = NULL;
	OV_INSTPTR_cshmi_Circle pCircle = NULL;
	OV_INSTPTR_cshmi_Text pText = NULL;

	OV_STRING temp = NULL;
	OV_UINT i = 0;
	OV_BOOL elementInstantiated = FALSE;

	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Group, pObj){
		elementInstantiated = TRUE;
		pGroup = Ov_StaticPtrCast(cshmi_Group, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		ov_string_print(strResult, "%s%%22x%%22:%%22%f%%22,", *strResult, pGroup->v_x);
		ov_string_print(strResult, "%s%%22y%%22:%%22%f%%22,", *strResult, pGroup->v_y);
		ov_string_print(strResult, "%s%%22width%%22:%%22%f%%22,", *strResult, pGroup->v_width);
		ov_string_print(strResult, "%s%%22height%%22:%%22%f%%22,", *strResult, pGroup->v_height);
		ov_string_print(strResult, "%s%%22hideable%%22:%%22%s%%22,", *strResult, (pGroup->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_print(strResult, "%s%%22visible%%22:%%22%s%%22", *strResult, (pGroup->v_visible==TRUE?"TRUE":"FALSE"));
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_TemplateDefinition, pObj){
		elementInstantiated = TRUE;
		pTemplateDefinition = Ov_StaticPtrCast(cshmi_TemplateDefinition, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		ov_string_print(strResult, "%s%%22width%%22:%%22%f%%22,", *strResult, pTemplateDefinition->v_width);
		ov_string_print(strResult, "%s%%22height%%22:%%22%f%%22", *strResult, pTemplateDefinition->v_height);
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Template, pObj){
		elementInstantiated = TRUE;
		pTemplate = Ov_StaticPtrCast(cshmi_Template, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(strResult, Ov_PtrUpCast(cshmi_Element, pTemplate));
		ov_string_print(strResult, "%s%%22TemplateDefinition%%22:%%22%s%%22,", *strResult, pTemplate->v_TemplateDefinition==NULL?"":pTemplate->v_TemplateDefinition);
		ov_string_print(strResult, "%s%%22x%%22:%%22%f%%22,", *strResult, pTemplate->v_x);
		ov_string_print(strResult, "%s%%22y%%22:%%22%f%%22,", *strResult, pTemplate->v_y);

		ov_string_print(strResult, "%s%%22FBReference%%22:%%22%s%%22,", *strResult, pTemplate->v_FBReference.veclen!=1?"":pTemplate->v_FBReference.value[0]);

		if(pTemplate->v_FBVariableReference.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pTemplate->v_FBVariableReference.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pTemplate->v_FBVariableReference.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pTemplate->v_FBVariableReference.value[0]);
			for(i = 1; i < pTemplate->v_FBVariableReference.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pTemplate->v_FBVariableReference.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(strResult, "%s%%22FBVariableReference%%22:%s,", *strResult, temp);

		if(pTemplate->v_ConfigValues.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pTemplate->v_ConfigValues.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pTemplate->v_ConfigValues.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pTemplate->v_ConfigValues.value[0]);
			for(i = 1; i < pTemplate->v_ConfigValues.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pTemplate->v_ConfigValues.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(strResult, "%s%%22ConfigValues%%22:%s,", *strResult, temp);

		ov_string_print(strResult, "%s%%22hideable%%22:%%22%s%%22", *strResult, (pTemplate->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	};
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_InstantiateTemplate, pObj){
		elementInstantiated = TRUE;
		pInstantiateTemplate = Ov_StaticPtrCast(cshmi_InstantiateTemplate, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		ov_string_print(strResult, "%s%%22visible%%22:%%22%s%%22,", *strResult, (pInstantiateTemplate->v_visible==TRUE?"TRUE":"FALSE"));
		ov_string_print(strResult, "%s%%22stroke%%22:%%22%s%%22,", *strResult, pInstantiateTemplate->v_stroke==NULL?"":pInstantiateTemplate->v_stroke);
		ov_string_print(strResult, "%s%%22fill%%22:%%22%s%%22,", *strResult, pInstantiateTemplate->v_fill==NULL?"":pInstantiateTemplate->v_fill);
		ov_string_print(strResult, "%s%%22opacity%%22:%%22%f%%22,", *strResult, pInstantiateTemplate->v_opacity);
		ov_string_print(strResult, "%s%%22rotate%%22:%%22%i%%22,", *strResult, pInstantiateTemplate->v_rotate);
		ov_string_print(strResult, "%s%%22TemplateDefinition%%22:%%22%s%%22,", *strResult, pInstantiateTemplate->v_TemplateDefinition==NULL?"":pInstantiateTemplate->v_TemplateDefinition);
		ov_string_print(strResult, "%s%%22x%%22:%%22%f%%22,", *strResult, pInstantiateTemplate->v_x);
		ov_string_print(strResult, "%s%%22y%%22:%%22%f%%22,", *strResult, pInstantiateTemplate->v_y);
		ov_string_print(strResult, "%s%%22xOffset%%22:%%22%f%%22,", *strResult, pInstantiateTemplate->v_xOffset);
		ov_string_print(strResult, "%s%%22yOffset%%22:%%22%f%%22,", *strResult, pInstantiateTemplate->v_yOffset);
		ov_string_print(strResult, "%s%%22maxTemplatesPerDirection%%22:%%22%f%%22,", *strResult, pInstantiateTemplate->v_maxTemplatesPerDirection);
		ov_string_print(strResult, "%s%%22FBReference%%22:%%22%s%%22,", *strResult, pInstantiateTemplate->v_FBReference.veclen!=1?"":pInstantiateTemplate->v_FBReference.value[0]);

		if(pInstantiateTemplate->v_FBVariableReference.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pInstantiateTemplate->v_FBVariableReference.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pInstantiateTemplate->v_FBVariableReference.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pInstantiateTemplate->v_FBVariableReference.value[0]);
			for(i = 1; i < pInstantiateTemplate->v_FBVariableReference.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pInstantiateTemplate->v_FBVariableReference.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(strResult, "%s%%22FBVariableReference%%22:%s,", *strResult, temp);

		if(pTemplate->v_ConfigValues.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pTemplate->v_ConfigValues.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pTemplate->v_ConfigValues.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pTemplate->v_ConfigValues.value[0]);
			for(i = 1; i < pTemplate->v_ConfigValues.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pTemplate->v_ConfigValues.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(strResult, "%s%%22ConfigValues%%22:%s,", *strResult, temp);

		ov_string_print(strResult, "%s%%22hideable%%22:%%22%s%%22", *strResult, (pInstantiateTemplate->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	};
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Rectangle, pObj){
		elementInstantiated = TRUE;
		pRectangle = Ov_StaticPtrCast(cshmi_Rectangle, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(strResult, Ov_PtrUpCast(cshmi_Element, pRectangle));
		ov_string_print(strResult, "%s%%22x%%22:%%22%f%%22,", *strResult, pRectangle->v_x);
		ov_string_print(strResult, "%s%%22y%%22:%%22%f%%22,", *strResult, pRectangle->v_y);
		ov_string_print(strResult, "%s%%22width%%22:%%22%f%%22,", *strResult, pRectangle->v_width);
		ov_string_print(strResult, "%s%%22height%%22:%%22%f%%22,", *strResult, pRectangle->v_height);
		ov_string_print(strResult, "%s%%22strokeWidth%%22:%%22%f%%22", *strResult, pRectangle->v_strokeWidth);
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Circle, pObj){
		elementInstantiated = TRUE;
		pCircle = Ov_StaticPtrCast(cshmi_Circle, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(strResult, Ov_PtrUpCast(cshmi_Element, pCircle));
		ov_string_print(strResult, "%s%%22cx%%22:%%22%f%%22,", *strResult, pCircle->v_cx);
		ov_string_print(strResult, "%s%%22cy%%22:%%22%f%%22,", *strResult, pCircle->v_cy);
		ov_string_print(strResult, "%s%%22r%%22:%%22%f%%22,", *strResult, pCircle->v_r);
		ov_string_print(strResult, "%s%%22strokeWidth%%22:%%22%f%%22", *strResult, pCircle->v_strokeWidth);
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Text, pObj){
		elementInstantiated = TRUE;
		pText = Ov_StaticPtrCast(cshmi_Text, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(strResult, Ov_PtrUpCast(cshmi_Element, pText));
		ov_string_print(strResult, "%s%%22x%%22:%%22%f%%22,", *strResult, pText->v_x);
		ov_string_print(strResult, "%s%%22y%%22:%%22%f%%22,", *strResult, pText->v_y);
		ov_string_print(strResult, "%s%%22content%%22:%%22%s%%22,", *strResult, pText->v_content==NULL?"":pText->v_content);
		ov_string_print(strResult, "%s%%22fontSize%%22:%%22%s%%22,", *strResult, pText->v_fontSize==NULL?"":pText->v_fontSize);
		ov_string_print(strResult, "%s%%22fontStyle%%22:%%22%s%%22,", *strResult, pText->v_fontStyle==NULL?"":pText->v_fontStyle);
		ov_string_print(strResult, "%s%%22fontWeight%%22:%%22%s%%22,", *strResult, pText->v_fontWeight==NULL?"":pText->v_fontWeight);
		ov_string_print(strResult, "%s%%22fontFamily%%22:%%22%s%%22,", *strResult, pText->v_fontFamily==NULL?"":pText->v_fontFamily);
		ov_string_print(strResult, "%s%%22horAlignment%%22:%%22%s%%22,", *strResult, pText->v_horAlignment==NULL?"":pText->v_horAlignment);
		ov_string_print(strResult, "%s%%22verAlignment%%22:%%22%s%%22,", *strResult, pText->v_verAlignment==NULL?"":pText->v_verAlignment);
		ov_string_print(strResult, "%s%%22trimToLength%%22:%%22%i%%22", *strResult, pText->v_trimToLength);
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}

	ov_string_setvalue(&temp, NULL);
	return OV_ERR_OK;
}

/**
 *
 * @param strResult
 * @return
 */
OV_BOOL cshmi_downloadApplication_buildActionList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_SetValue pSetValue = NULL;
	OV_INSTPTR_cshmi_GetValue pGetValue = NULL;
	OV_INSTPTR_cshmi_ChildrenIterator pChildrenIterator = NULL;
	OV_INSTPTR_cshmi_IfThenElse pIfThenElse = NULL;

	OV_STRING ParameterName = NULL;
	OV_STRING ParameterValue = NULL;
	OV_BOOL elementInstantiated = FALSE;
	OV_UINT i = 0;

	Ov_ForEachChild(ov_instantiation, pclass_cshmi_SetValue, pObj){
		elementInstantiated = TRUE;
		pSetValue = Ov_StaticPtrCast(cshmi_SetValue, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");

		if(ov_string_compare(pSetValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_ksVar);
		}else if(ov_string_compare(pSetValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_elemVar);
		}else if(ov_string_compare(pSetValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_globalVar);
		}else if(ov_string_compare(pSetValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pSetValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pSetValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pSetValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, NULL);
			ov_string_setvalue(&ParameterValue, NULL);
		}
		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(strResult, "%s%%22ParameterName%%22:%%22%s%%22,", *strResult, ParameterName);
		}else{
			ov_string_print(strResult, "%s%%22ParameterName%%22:%%22%%22,", *strResult);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(strResult, "%s%%22ParameterValue%%22:%%22%s%%22", *strResult, ParameterValue);
		}else{
			ov_string_print(strResult, "%s%%22ParameterValue%%22:%%22%%22", *strResult);
		}
		ov_string_append(strResult, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_GetValue, pObj){
		elementInstantiated = TRUE;
		pGetValue = Ov_StaticPtrCast(cshmi_GetValue, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");

		if(ov_string_compare(pGetValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_ksVar);
		}else if(ov_string_compare(pGetValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_elemVar);
		}else if(ov_string_compare(pGetValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_globalVar);
		}else if(ov_string_compare(pGetValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pGetValue->v_OperatorInput, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "OperatorInput");
			ov_string_setvalue(&ParameterValue, pGetValue->v_OperatorInput);
		}else if(ov_string_compare(pGetValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pGetValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pGetValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, "value");
			switch (pGetValue->v_value.value.vartype) {
				case OV_VT_STRING_PV:
					ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string);
					break;
				case OV_VT_BOOL_PV:
					ov_string_print(&ParameterValue, "%s", (pGetValue->v_value.value.valueunion.val_bool==TRUE?"TRUE":"FALSE"));
					break;
				case OV_VT_INT_PV:
					ov_string_print(&ParameterValue, "%i", pGetValue->v_value.value.valueunion.val_int);
					break;
				case OV_VT_UINT_PV:
					ov_string_print(&ParameterValue, "%u", pGetValue->v_value.value.valueunion.val_uint);
					break;
				case OV_VT_DOUBLE_PV:
					ov_string_print(&ParameterValue, "%lf", pGetValue->v_value.value.valueunion.val_double);
					break;
				case OV_VT_STRING_PV_VEC:
					if(pGetValue->v_value.value.valueunion.val_string_vec.veclen==0){
						ov_string_setvalue(&ParameterValue, NULL);
					}else if(pGetValue->v_value.value.valueunion.val_string_vec.veclen==1){
						ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[0]);
					}else{
						ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[0]);
						for ( i = 1; i < pGetValue->v_value.value.valueunion.val_string_vec.veclen;i++){
							ov_string_print(&ParameterValue, "%s %s", ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[i]);
						}
					}
					break;
				default:
					//fixme diese iteration des GetValue sollte übersprungen werden, da value falsch ist.
					ov_string_setvalue(&ParameterValue, NULL);
					break;
			}
		}
		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(strResult, "%s%%22ParameterName%%22:%%22%s%%22,", *strResult, ParameterName);
		}else{
			ov_string_print(strResult, "%s%%22ParameterName%%22:%%22%%22,", *strResult);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(strResult, "%s%%22ParameterValue%%22:%%22%s%%22", *strResult, ParameterValue);
		}else{
			ov_string_print(strResult, "%s%%22ParameterValue%%22:%%22%%22", *strResult);
		}
		ov_string_append(strResult, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_ChildrenIterator, pObj){
		elementInstantiated = TRUE;
		pChildrenIterator = Ov_StaticPtrCast(cshmi_ChildrenIterator, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_print(strResult, "%s%%22ChildrenIteratorParameterChildrenType%%22:%%22%s%%22", *strResult, pChildrenIterator->v_ChildrenType);
		ov_string_append(strResult, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_IfThenElse, pObj){
		elementInstantiated = TRUE;
		pIfThenElse = Ov_StaticPtrCast(cshmi_IfThenElse, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_print(strResult, "%s%%22IfThenElseParameterAnycond%%22:%%22%s%%22", *strResult, (pIfThenElse->v_anycond==TRUE?"TRUE":"FALSE"));
		ov_string_append(strResult, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	return OV_ERR_OK;
}


OV_BOOL cshmi_downloadApplication_buildConditionList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_Compare pCompare = NULL;
	OV_INSTPTR_cshmi_CompareIteratedChild pCompareIteratedChild = NULL;

	OV_BOOL elementInstantiated = FALSE;

	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Compare, pObj){
		elementInstantiated = TRUE;
		pCompare = Ov_StaticPtrCast(cshmi_Compare, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");
		ov_string_print(strResult, "%s%%22comptype%%22:%%22%s%%22,", *strResult, pCompare->v_comptype);
		ov_string_print(strResult, "%s%%22ignoreError%%22:%%22%s%%22", *strResult, (pCompare->v_ignoreError==TRUE?"TRUE":"FALSE"));
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	if(elementInstantiated == TRUE){
		ov_string_append(strResult, ",");
	}
	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_CompareIteratedChild, pObj){
		elementInstantiated = TRUE;
		pCompareIteratedChild = Ov_StaticPtrCast(cshmi_CompareIteratedChild, pObj);
		ov_string_append(strResult, "%22");
		ov_memstack_lock();
		ov_string_append(strResult, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(strResult, "%22:%7B");
		ov_string_append(strResult, "%22Parameters%22:%7B");

		ov_string_print(strResult, "%s%%22comptype%%22:%%22%s%%22,", *strResult, pCompareIteratedChild->v_comptype);
		ov_string_print(strResult, "%s%%22childValue%%22:%%22%s%%22,", *strResult, pCompareIteratedChild->v_childValue);
		ov_string_print(strResult, "%s%%22ignoreError%%22:%%22%s%%22", *strResult, (pCompareIteratedChild->v_ignoreError==TRUE?"TRUE":"FALSE"));
		ov_string_append(strResult, "%7D");
		ov_string_append(strResult, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(strResult, ",");
		}
	}
	return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_STRING cshmi_downloadApplication_asJSON_get(
    OV_INSTPTR_cshmi_downloadApplication          pThis
) {
	OV_STRING returnString;
	OV_STRING strResult = NULL;
	OV_INSTPTR_ov_object pObj = NULL;

	OV_TIME lasttime;
	OV_TIME thistime;
	OV_TIME_SPAN diff;

	pObj = ov_path_getobjectpointer("/TechUnits/cshmi", 2);
	if(pObj == NULL || !Ov_CanCastTo(ov_domain, pObj)){
		return (OV_STRING) 0;
	}

	//open JSON Element
	ov_string_setvalue(&strResult, "%7B");

	/**
	 * Umsetzungstabelle für decodeURI
	 * " %22
	 * { %7B
	 * } %7D
	 * [ %5B
	 * ] %5D
	 * ( (
	 * ) )
	 * + +
	 */

	/**
	 * Tools:
	 * http://meyerweb.com/eric/tools/dencoder/
	 * http://jsonviewer.stack.hu/
	 * http://jsonlint.com/
	 */

	//todo
	//some static baseKsPath settings
	ov_string_append(&strResult, "%22baseKsPath%22:%7B%22/TechUnits/cshmi%22:[],%22/TechUnits/cshmi/Templates%22:[]%7D,");

	ov_time_gettime(&lasttime);

	//Elements is a list of configured elements
	ov_string_append(&strResult, "%22Elements%22:%7B");
	cshmi_downloadApplication_buildElementList(&strResult);
	ov_string_append(&strResult, "%7D,");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Elements: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	//Actions is a list of actions, set/get stores the result only
	ov_string_append(&strResult, "%22Actions%22:%7B");
	cshmi_downloadApplication_buildActionList(&strResult);
	ov_string_append(&strResult, "%7D,");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Actions: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	//Conditions saves all conditions
	ov_string_append(&strResult, "%22Conditions%22:%7B");
	cshmi_downloadApplication_buildConditionList(&strResult);
	ov_string_append(&strResult, "%7D,");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Conditions: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	//ChildList is a list of ov_containment
	ov_string_append(&strResult, "%22ChildList%22:%7B");
	cshmi_downloadApplication_buildChildList(pObj, &strResult, TRUE);
	ov_string_append(&strResult, "%7D");

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Childlist: %s", ov_time_timespantoascii(&diff));
	ov_time_gettime(&lasttime);

	//close JSON Element
	ov_string_append(&strResult, "%7D");

	returnString = (OV_STRING) ov_memstack_alloc(ov_path_percentsize(strResult));
	strcpy(returnString, strResult);
	ov_string_setvalue(&strResult, NULL);
	return returnString;

}
