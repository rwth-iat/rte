
/******************************************************************************
*
*   FILE
*   ----
*   downloadApplication.c
*
*   History
*   -------
*   2013-04-29   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_cshmi
#define OV_COMPILE_LIBRARY_cshmi
#endif

#include "cshmilib.h"

//#define CSHMI_TIMING_DEBUG 1
//#define CSHMI_CHILDLIST_DEBUG 1

#ifdef CSHMI_TIMING_DEBUG
	OV_UINT functioncounter = 0;
	OV_UINT iterationcounter = 0;
	OV_UINT cntPrepareURIencode = 0;
	OV_DOUBLE sumTimePrepareURIencode = 0;
#endif

/**
 * returns a list of ov_containment
 * embedment/OV_PART is known to the visualisation system
 * @param pObj object to start childlist
 * @param strResult Pointer to the result String
 * @param isFirstEntry if FALSE the function adds an "," as a separator
 * @return
 */
static OV_RESULT cshmi_downloadApplication_buildChildList(OV_INSTPTR_ov_object pObj, OV_STRING*strResult, OV_BOOL isFirstEntry){
	OV_INSTPTR_ov_object pChildObj = NULL;
	OV_INSTPTR_cshmi_IfThenElse pIfThenElse = NULL;
	OV_INSTPTR_cshmi_ChildrenIterator pChildrenIterator = NULL;

	//local string to make ov_string functions fast
	OV_STRING strChildList = NULL;
	OV_RESULT result = OV_ERR_OK;

#ifdef CSHMI_TIMING_DEBUG
	functioncounter++;
#endif

	/* builds something like this (without the whitespaces):
	%22/TechUnits/cshmi%22:%7B
		%22ChildListParameters%22:%5B
			%22turbo /acplt/cshmi/downloadApplication%22,
			%22Templates /acplt/ov/domain%22
		%5D
	%7D,
	%22/TechUnits/cshmi/Templates%22:%7B
		%22ChildListParameters%22:%5B
		%5D
	%7D,
	%22/TechUnits/sheet%22:
	%7B
		%22ChildListParameters%22:%5B
		%5D
	%7D
	*/
	if(!Ov_CanCastTo(ov_domain, pObj)){
		return OV_ERR_OK;
	}
#ifdef CSHMI_CHILDLIST_DEBUG
	ov_logfile_debug("Childlist: listing children for %s", pObj->v_identifier);
#endif


	if(isFirstEntry == FALSE){
		ov_string_setvalue(&strChildList, ",%22");
	}else{
		ov_string_setvalue(&strChildList, "%22");
	}
	ov_memstack_lock();
	ov_string_append(&strChildList, ov_path_getcanonicalpath(pObj, 2));
	ov_memstack_unlock();
	ov_string_append(&strChildList, "%22:%7B");
	ov_string_append(&strChildList, "%22ChildListParameters%22:%5B");

	//iterate over all childrens and list them
	Ov_ForEachChild(ov_containment, Ov_StaticPtrCast(ov_domain, pObj), pChildObj){
		ov_string_append(&strChildList, "%22");
		ov_string_append(&strChildList, pChildObj->v_identifier);
		ov_string_append(&strChildList, " ");
		ov_memstack_lock();
		ov_string_append(&strChildList, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, Ov_GetClassPtr(pChildObj)), 2));
		ov_memstack_unlock();
		ov_string_append(&strChildList, "%22");
		if(Ov_GetNextChild(ov_containment, pChildObj) != NULL){
			ov_string_append(&strChildList, ",");
		}
	};
	ov_string_append(&strChildList, "%5D%7D");

	//one single append to the huge string
	result = ov_string_append(strResult, strChildList);
	ov_string_setvalue(&strChildList, NULL);
	if(Ov_Fail(result)){
		return result;
	}

	//some of our children should list their children, too
	Ov_ForEachChild(ov_containment, Ov_StaticPtrCast(ov_domain, pObj), pChildObj){
		//interesting children are domains or some cshmi objects
		if(	Ov_GetParent(ov_instantiation, pChildObj) == pclass_ov_domain
			|| Ov_CanCastTo(cshmi_ContainerElement, pChildObj)
			|| Ov_CanCastTo(cshmi_Element, pChildObj)
			|| Ov_GetParent(ov_instantiation, pChildObj) == pclass_cshmi_SetConcatValue
			|| Ov_GetParent(ov_instantiation, pChildObj) == pclass_cshmi_SetMathValue
			|| Ov_CanCastTo(cshmi_Event, pChildObj)
			){
			result = cshmi_downloadApplication_buildChildList(pChildObj, strResult, FALSE);
			if(Ov_Fail(result)){
				return result;
			}
		}else
		//some children have no containment but their parts have interesting containments
		if(Ov_GetParent(ov_instantiation, pChildObj) == pclass_cshmi_IfThenElse){
			pIfThenElse = Ov_StaticPtrCast(cshmi_IfThenElse, pChildObj);
			result = cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_if), strResult, FALSE);
			if(Ov_Fail(result)){
				return result;
			}
			result = cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_then), strResult, FALSE);
			if(Ov_Fail(result)){
				return result;
			}
			result = cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pIfThenElse->p_else), strResult, FALSE);
			if(Ov_Fail(result)){
				return result;
			}
		}else if(Ov_GetParent(ov_instantiation, pChildObj) == pclass_cshmi_ChildrenIterator){
			pChildrenIterator = Ov_StaticPtrCast(cshmi_ChildrenIterator, pChildObj);
			result = cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, &pChildrenIterator->p_forEachChild), strResult, FALSE);
			if(Ov_Fail(result)){
				return result;
			}
#ifdef CSHMI_CHILDLIST_DEBUG
		}else{
			ov_logfile_debug("Childlist: skipped childrenlist for %s", pChildObj->v_identifier);
#endif
		}
	}

	return OV_ERR_OK;
}

/**
 * encodes the string in a percent encoding
 * call ov_memstack_allow arround this!
 * @param strIn
 * @return
 */
static OV_STRING cshmi_downloadApplication_prepareURIencode(OV_STRING strIn){
	OV_STRING	pcIn;
	OV_STRING	pcOut = 0;
	OV_STRING	strOut;

#ifdef CSHMI_TIMING_DEBUG
	OV_TIME startTime;
	OV_TIME endTime;
	OV_TIME_SPAN runTime;
	OV_DOUBLE runTimeDouble;
	ov_time_gettime(&startTime);
	cntPrepareURIencode++;
#endif
	if(!strIn){
		strOut = (OV_STRING)ov_memstack_alloc(1);
		strOut = '\0';
		return strOut;
	}
	//only " would be the worst case
	strOut = (OV_STRING) ov_memstack_alloc(ov_string_getlength(strIn)*6+1);

	pcIn = strIn;
	pcOut = strOut;
	while(*pcIn) {
		if(*pcIn == '\n'){
			*pcOut = ' ';
		}else if(*pcIn == '\r'){
			*pcOut = ' ';
		}else if(*pcIn == '%'){
			*pcOut = '%';
			pcOut++;
			*pcOut = '2';
			pcOut++;
			*pcOut = '5';
		}else if(*pcIn == '"'){
			// JSON needs " has to be encoded to \", %5C%22 is urlencoded json escaping
			*pcOut = '%';	//JSON encoding of a backslash!
			pcOut++;
			*pcOut = '5';
			pcOut++;
			*pcOut = 'C';	//JSON end
			pcOut++;
			*pcOut = '%';	//urlencoding of a quote
			pcOut++;
			*pcOut = '2';
			pcOut++;
			*pcOut = '2';
		}else if(*pcIn == '{'){
			*pcOut = '%';
			pcOut++;
			*pcOut = '7';
			pcOut++;
			*pcOut = 'B';
		}else if(*pcIn == '}'){
			*pcOut = '%';
			pcOut++;
			*pcOut = '7';
			pcOut++;
			*pcOut = 'D';
		}else if(*pcIn == '['){
			*pcOut = '%';
			pcOut++;
			*pcOut = '5';
			pcOut++;
			*pcOut = 'B';
		}else if(*pcIn == ']'){
			*pcOut = '%';
			pcOut++;
			*pcOut = '5';
			pcOut++;
			*pcOut = 'D';
		}else if(*pcIn == '\\'){
			*pcOut = '%';
			pcOut++;
			*pcOut = '5';
			pcOut++;
			*pcOut = 'C';
		}else{
			*pcOut = *pcIn;
		}
		pcIn++;
		pcOut++;
	}
	*pcOut = '\0';		/*append terminating '\0'*/

#ifdef CSHMI_TIMING_DEBUG
	ov_time_gettime(&endTime);
	ov_time_diff(&runTime, &endTime, &startTime);
	Ov_TimeSpanToDouble(runTime, runTimeDouble);
	sumTimePrepareURIencode += runTimeDouble;
#endif

	return strOut;
}


/**
 * prints the basic types to the string (visible, stroke, fill, opacity, rotate)
 * @param strResult
 * @param pElement
 * @return
 */
static OV_RESULT cshmi_downloadApplication_buildBaseElementString(OV_STRING*strResult, OV_INSTPTR_cshmi_Element pElement){
	ov_string_print(strResult, "%s%%22visible%%22:%%22%s%%22,", *strResult, (pElement->v_visible==TRUE?"TRUE":"FALSE"));
	ov_string_print(strResult, "%s%%22stroke%%22:%%22%s%%22,", *strResult, pElement->v_stroke==NULL?"":pElement->v_stroke);
	ov_string_print(strResult, "%s%%22fill%%22:%%22%s%%22,", *strResult, pElement->v_fill==NULL?"":pElement->v_fill);
	ov_string_print(strResult, "%s%%22opacity%%22:%%22%f%%22,", *strResult, pElement->v_opacity);
	ov_string_print(strResult, "%s%%22rotate%%22:%%22%i%%22,", *strResult, pElement->v_rotate);
	return OV_ERR_OK;
}
/**
 *	builds the graphical elements into the cache
 * @param strResult
 * @return
 */
static OV_RESULT cshmi_downloadApplication_buildElementList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_InstantiateTemplate pInstantiateTemplate = NULL;
	OV_INSTPTR_cshmi_Group pGroup = NULL;
	OV_INSTPTR_cshmi_TemplateDefinition pTemplateDefinition = NULL;
	OV_INSTPTR_cshmi_Rectangle pRectangle = NULL;
	OV_INSTPTR_cshmi_Circle pCircle = NULL;
	OV_INSTPTR_cshmi_Text pText = NULL;
	OV_INSTPTR_cshmi_Line pLine = NULL;
	OV_INSTPTR_cshmi_Polyline pPolyline = NULL;
	OV_INSTPTR_cshmi_Polygon pPolygon = NULL;
	OV_INSTPTR_cshmi_Path pPath = NULL;
	OV_INSTPTR_cshmi_Ellipse pEllipse = NULL;

	//be careful to adjust the ov_string_print at the end of the function
	#define MAXELEMENTENTRIES 11
	OV_STRING ResultListVec[MAXELEMENTENTRIES] = {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL};
	//Note: we do not precache blackbox or image! To risky with the encoding of the Strings.
	OV_STRING strIterate = NULL;
	OV_UINT ResultListIndex = 0;
	OV_STRING ResultFormat = NULL;

	OV_STRING temp = NULL;
	OV_UINT i = 0;
	OV_BOOL elementInstantiated = FALSE;
	OV_BOOL elementIsfirst = TRUE;
	OV_RESULT result = OV_ERR_OK;
	ov_string_setvalue(&ResultFormat, "%s");

#ifdef CSHMI_TIMING_DEBUG
	functioncounter++;
#endif

	/* builds something like this (without the whitespaces):
	%22/TechUnits/sheet%22:%7B
		%22Parameters%22:%7B
			%22x%22:%220.000000%22,
			%22y%22:%220.000000%22,
			%22width%22:%221000.000000%22,
			%22height%22:%22900.000000%22,
			%22opacity%22:%221.000000%22,
			%22rotate%22:%220%22,
			%22hideable%22:%22FALSE%22,
			%22visible%22:%22TRUE%22,
			%22TemplateDefinition%22:%22%22,
			%22FBReference%22:%22%22,
			%22FBVariableReference%22:%22%22,
			%22ConfigValues%22:%22%22
		%7D
	%7D
	 */

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Group, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pGroup = Ov_StaticPtrCast(cshmi_Group, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22x%%22:%%22%f%%22,", strIterate, pGroup->v_x);
		ov_string_print(&strIterate, "%s%%22y%%22:%%22%f%%22,", strIterate, pGroup->v_y);
		ov_string_print(&strIterate, "%s%%22width%%22:%%22%f%%22,", strIterate, pGroup->v_width);
		ov_string_print(&strIterate, "%s%%22height%%22:%%22%f%%22,", strIterate, pGroup->v_height);
		ov_string_print(&strIterate, "%s%%22opacity%%22:%%22%f%%22,", strIterate, pGroup->v_opacity);
		ov_string_print(&strIterate, "%s%%22rotate%%22:%%22%i%%22,", strIterate, pGroup->v_rotate);
		ov_string_print(&strIterate, "%s%%22hideable%%22:%%22%s%%22,", strIterate, (pGroup->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_print(&strIterate, "%s%%22visible%%22:%%22%s%%22,", strIterate, (pGroup->v_visible==TRUE?"TRUE":"FALSE"));
		ov_string_print(&strIterate, "%s%%22TemplateDefinition%%22:%%22%s%%22,", strIterate, ov_string_compare(pGroup->v_TemplateDefinition, "")==OV_STRCMP_EQUAL?"":pGroup->v_TemplateDefinition);
		ov_string_print(&strIterate, "%s%%22FBReference%%22:%%22%s%%22,", strIterate, (pGroup->v_FBReference.veclen!=1||ov_string_compare(pGroup->v_FBReference.value[0], "")==OV_STRCMP_EQUAL)?"":pGroup->v_FBReference.value[0]);

		if(pGroup->v_FBVariableReference.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pGroup->v_FBVariableReference.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pGroup->v_FBVariableReference.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pGroup->v_FBVariableReference.value[0]);
			for(i = 1; i < pGroup->v_FBVariableReference.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pGroup->v_FBVariableReference.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterate, "%s%%22FBVariableReference%%22:%s,", strIterate, temp);

		if(pGroup->v_ConfigValues.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pGroup->v_ConfigValues.veclen == 1){
			ov_memstack_lock();
			ov_string_print(&temp, "%%22%s%%22", cshmi_downloadApplication_prepareURIencode(pGroup->v_ConfigValues.value[0]));
			ov_memstack_unlock();
		}else{
			ov_memstack_lock();
			ov_string_print(&temp, "%%22%s", cshmi_downloadApplication_prepareURIencode(pGroup->v_ConfigValues.value[0]));
			ov_memstack_unlock();
			for(i = 1; i < pGroup->v_ConfigValues.veclen;i++){
				ov_memstack_lock();
				ov_string_print(&temp, "%s %s", temp, cshmi_downloadApplication_prepareURIencode(pGroup->v_ConfigValues.value[i]));
				ov_memstack_unlock();
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterate, "%s%%22ConfigValues%%22:%s", strIterate, temp);


		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_TemplateDefinition, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pTemplateDefinition = Ov_StaticPtrCast(cshmi_TemplateDefinition, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22width%%22:%%22%f%%22,", strIterate, pTemplateDefinition->v_width);
		ov_string_print(&strIterate, "%s%%22height%%22:%%22%f%%22", strIterate, pTemplateDefinition->v_height);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_InstantiateTemplate, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pInstantiateTemplate = Ov_StaticPtrCast(cshmi_InstantiateTemplate, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22visible%%22:%%22%s%%22,", strIterate, (pInstantiateTemplate->v_visible==TRUE?"TRUE":"FALSE"));
		ov_string_print(&strIterate, "%s%%22stroke%%22:%%22%s%%22,", strIterate, pInstantiateTemplate->v_stroke==NULL?"":pInstantiateTemplate->v_stroke);
		ov_string_print(&strIterate, "%s%%22fill%%22:%%22%s%%22,", strIterate, pInstantiateTemplate->v_fill==NULL?"":pInstantiateTemplate->v_fill);
		ov_string_print(&strIterate, "%s%%22opacity%%22:%%22%f%%22,", strIterate, pInstantiateTemplate->v_opacity);
		ov_string_print(&strIterate, "%s%%22rotate%%22:%%22%i%%22,", strIterate, pInstantiateTemplate->v_rotate);
		ov_string_print(&strIterate, "%s%%22TemplateDefinition%%22:%%22%s%%22,", strIterate, ov_string_compare(pInstantiateTemplate->v_TemplateDefinition, "")==OV_STRCMP_EQUAL?"":pInstantiateTemplate->v_TemplateDefinition);
		ov_string_print(&strIterate, "%s%%22x%%22:%%22%f%%22,", strIterate, pInstantiateTemplate->v_x);
		ov_string_print(&strIterate, "%s%%22y%%22:%%22%f%%22,", strIterate, pInstantiateTemplate->v_y);
		ov_string_print(&strIterate, "%s%%22xOffset%%22:%%22%f%%22,", strIterate, pInstantiateTemplate->v_xOffset);
		ov_string_print(&strIterate, "%s%%22yOffset%%22:%%22%f%%22,", strIterate, pInstantiateTemplate->v_yOffset);
		ov_string_print(&strIterate, "%s%%22maxTemplatesPerDirection%%22:%%22%s%%22,", strIterate, ov_string_compare(pInstantiateTemplate->v_maxTemplatesPerDirection, "")==OV_STRCMP_EQUAL?"":pInstantiateTemplate->v_maxTemplatesPerDirection);
		ov_string_print(&strIterate, "%s%%22preventClone%%22:%%22%s%%22,", strIterate, (pInstantiateTemplate->v_preventClone==TRUE?"TRUE":"FALSE"));
		ov_string_print(&strIterate, "%s%%22FBReference%%22:%%22%s%%22,", strIterate, (pInstantiateTemplate->v_FBReference.veclen!=1||ov_string_compare(pInstantiateTemplate->v_FBReference.value[0], "")==OV_STRCMP_EQUAL)?"":pInstantiateTemplate->v_FBReference.value[0]);

		if(pInstantiateTemplate->v_FBVariableReference.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pInstantiateTemplate->v_FBVariableReference.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pInstantiateTemplate->v_FBVariableReference.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pInstantiateTemplate->v_FBVariableReference.value[0]);
			for(i = 1; i < pInstantiateTemplate->v_FBVariableReference.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pInstantiateTemplate->v_FBVariableReference.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterate, "%s%%22FBVariableReference%%22:%s,", strIterate, temp);

		if(pInstantiateTemplate->v_ConfigValues.veclen == 0){
			ov_string_setvalue(&temp, "%22%22");
		}else if(pInstantiateTemplate->v_ConfigValues.veclen == 1){
			ov_string_print(&temp, "%%22%s%%22", pInstantiateTemplate->v_ConfigValues.value[0]);
		}else{
			ov_string_print(&temp, "%%22%s", pInstantiateTemplate->v_ConfigValues.value[0]);
			for(i = 1; i < pInstantiateTemplate->v_ConfigValues.veclen;i++){
				ov_string_print(&temp, "%s %s", temp, pInstantiateTemplate->v_ConfigValues.value[i]);
			}
			ov_string_append(&temp, "%22");
		}
		ov_string_print(&strIterate, "%s%%22ConfigValues%%22:%s,", strIterate, temp);

		ov_string_print(&strIterate, "%s%%22hideable%%22:%%22%s%%22", strIterate, (pInstantiateTemplate->v_hideable==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	};
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Rectangle, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pRectangle = Ov_StaticPtrCast(cshmi_Rectangle, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pRectangle));
		ov_string_print(&strIterate, "%s%%22x%%22:%%22%f%%22,", strIterate, pRectangle->v_x);
		ov_string_print(&strIterate, "%s%%22y%%22:%%22%f%%22,", strIterate, pRectangle->v_y);
		ov_string_print(&strIterate, "%s%%22width%%22:%%22%f%%22,", strIterate, pRectangle->v_width);
		ov_string_print(&strIterate, "%s%%22height%%22:%%22%f%%22,", strIterate, pRectangle->v_height);
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pRectangle->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Circle, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pCircle = Ov_StaticPtrCast(cshmi_Circle, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pCircle));
		ov_string_print(&strIterate, "%s%%22cx%%22:%%22%f%%22,", strIterate, pCircle->v_cx);
		ov_string_print(&strIterate, "%s%%22cy%%22:%%22%f%%22,", strIterate, pCircle->v_cy);
		ov_string_print(&strIterate, "%s%%22r%%22:%%22%f%%22,", strIterate, pCircle->v_r);
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pCircle->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Text, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pText = Ov_StaticPtrCast(cshmi_Text, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pText));
		ov_string_print(&strIterate, "%s%%22x%%22:%%22%f%%22,", strIterate, pText->v_x);
		ov_string_print(&strIterate, "%s%%22y%%22:%%22%f%%22,", strIterate, pText->v_y);
		ov_memstack_lock();
		ov_string_print(&strIterate, "%s%%22content%%22:%%22%s%%22,", strIterate, (pText->v_content==NULL?"":cshmi_downloadApplication_prepareURIencode(pText->v_content)));
		ov_memstack_unlock();
		ov_string_print(&strIterate, "%s%%22fontSize%%22:%%22%s%%22,", strIterate, pText->v_fontSize==NULL?"":pText->v_fontSize);
		ov_string_print(&strIterate, "%s%%22fontStyle%%22:%%22%s%%22,", strIterate, pText->v_fontStyle==NULL?"":pText->v_fontStyle);
		ov_string_print(&strIterate, "%s%%22fontWeight%%22:%%22%s%%22,", strIterate, pText->v_fontWeight==NULL?"":pText->v_fontWeight);
		ov_string_print(&strIterate, "%s%%22fontFamily%%22:%%22%s%%22,", strIterate, pText->v_fontFamily==NULL?"":pText->v_fontFamily);
		ov_string_print(&strIterate, "%s%%22horAlignment%%22:%%22%s%%22,", strIterate, pText->v_horAlignment==NULL?"":pText->v_horAlignment);
		ov_string_print(&strIterate, "%s%%22verAlignment%%22:%%22%s%%22,", strIterate, pText->v_verAlignment==NULL?"":pText->v_verAlignment);
		ov_string_print(&strIterate, "%s%%22trimToLength%%22:%%22%i%%22", strIterate, pText->v_trimToLength);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Line, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pLine = Ov_StaticPtrCast(cshmi_Line, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pLine));
		ov_string_print(&strIterate, "%s%%22x1%%22:%%22%f%%22,", strIterate, pLine->v_x1);
		ov_string_print(&strIterate, "%s%%22y1%%22:%%22%f%%22,", strIterate, pLine->v_y1);
		ov_string_print(&strIterate, "%s%%22x2%%22:%%22%f%%22,", strIterate, pLine->v_x2);
		ov_string_print(&strIterate, "%s%%22y2%%22:%%22%f%%22,", strIterate, pLine->v_y2);
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pLine->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Polyline, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pPolyline = Ov_StaticPtrCast(cshmi_Polyline, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pPolyline));
		ov_memstack_lock();
		ov_string_print(&strIterate, "%s%%22points%%22:%%22%s%%22,", strIterate, (pPolyline->v_points==NULL?"":cshmi_downloadApplication_prepareURIencode(pPolyline->v_points)));
		ov_memstack_unlock();
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pPolyline->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Polygon, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pPolygon = Ov_StaticPtrCast(cshmi_Polygon, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pPolygon));
		ov_memstack_lock();
		ov_string_print(&strIterate, "%s%%22points%%22:%%22%s%%22,", strIterate, (pPolygon->v_points==NULL?"":cshmi_downloadApplication_prepareURIencode(pPolygon->v_points)));
		ov_memstack_unlock();
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pPolygon->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Path, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pPath = Ov_StaticPtrCast(cshmi_Path, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pPath));
		ov_memstack_lock();
		ov_string_print(&strIterate, "%s%%22d%%22:%%22%s%%22,", strIterate, (pPath->v_d==NULL?"":cshmi_downloadApplication_prepareURIencode(pPath->v_d)));
		ov_memstack_unlock();
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pPath->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Ellipse, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pEllipse = Ov_StaticPtrCast(cshmi_Ellipse, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		cshmi_downloadApplication_buildBaseElementString(&strIterate, Ov_PtrUpCast(cshmi_Element, pEllipse));
		ov_string_print(&strIterate, "%s%%22cx%%22:%%22%f%%22,", strIterate, pEllipse->v_cx);
		ov_string_print(&strIterate, "%s%%22cy%%22:%%22%f%%22,", strIterate, pEllipse->v_cy);
		ov_string_print(&strIterate, "%s%%22rx%%22:%%22%f%%22,", strIterate, pEllipse->v_rx);
		ov_string_print(&strIterate, "%s%%22ry%%22:%%22%f%%22,", strIterate, pEllipse->v_ry);
		ov_string_print(&strIterate, "%s%%22strokeWidth%%22:%%22%f%%22", strIterate, pEllipse->v_strokeWidth);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}


	//concat the result, in one batch for performance reasons (append is not cheap)
	result = ov_string_print(strResult, ResultFormat, *strResult, ResultListVec[0], ResultListVec[1], ResultListVec[2], ResultListVec[3], ResultListVec[4], ResultListVec[5], ResultListVec[6], ResultListVec[7], ResultListVec[8], ResultListVec[9], ResultListVec[10]);
	ov_string_setvalue(&ResultFormat, NULL);

	ov_string_setvalue(&temp, NULL);

	ov_string_setvalue(&strIterate, NULL);
	for(i = 0;i < MAXELEMENTENTRIES;i++){
		ov_string_setvalue(&ResultListVec[i], NULL);
	}

	return result;
}

/**
 *	builds the interactive elements (events/actions/conditions)
 * @param strResult
 * @return
 */
static OV_RESULT cshmi_downloadApplication_buildActionList(OV_STRING*strResult){
	OV_INSTPTR_ov_object pObj = NULL;
	OV_INSTPTR_cshmi_SetValue pSetValue = NULL;
	OV_INSTPTR_cshmi_SetConcatValue pSetConcatValue = NULL;
	OV_INSTPTR_cshmi_SetMathValue pSetMathValue = NULL;
	OV_INSTPTR_cshmi_GetValue pGetValue = NULL;
	OV_INSTPTR_cshmi_ChildrenIterator pChildrenIterator = NULL;
	OV_INSTPTR_cshmi_IfThenElse pIfThenElse = NULL;
	OV_INSTPTR_cshmi_Compare pCompare = NULL;
	OV_INSTPTR_cshmi_CompareIteratedChild pCompareIteratedChild = NULL;
	OV_INSTPTR_cshmi_RoutePolyline pRoutePolyline = NULL;
	OV_INSTPTR_cshmi_TimeEvent pTimeEvent = NULL;
	OV_INSTPTR_cshmi_TranslationSource pTranslationSource = NULL;
	OV_INSTPTR_cshmi_CreateObject pCreateObject = NULL;
	OV_INSTPTR_cshmi_Vibrate pVibrate = NULL;

	//be careful to adjust the ov_string_print at the end of the function
	#define MAXACTIONENTRIES 13
	OV_STRING ResultListVec[MAXACTIONENTRIES] = {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL};
	OV_STRING strIterate = NULL;
	OV_UINT ResultListIndex = 0;
	OV_STRING ResultFormat = NULL;
	OV_STRING ParameterName = NULL;
	OV_STRING ParameterValue = NULL;
	OV_STRING temp = NULL;
	OV_BOOL elementInstantiated = FALSE;
	OV_BOOL elementIsfirst = TRUE;
	OV_UINT i = 0;
	OV_RESULT result = OV_ERR_OK;
	ov_string_setvalue(&ResultFormat, "%s");

#ifdef CSHMI_TIMING_DEBUG
	functioncounter++;
#endif
	/* builds something like this (without the whitespaces):
	%22/TechUnits/sheet/onload/set%22:%7B
		%22translationSource%22:%22%22,
		%22ParameterName%22:%22elemVar%22,
		%22ParameterValue%22:%22fill%22,
		%22translationSource%22:%22%22
	%7D,
	%22/TechUnits/sheet/onload/set.value%22:%7B
		%22ParameterName%22:%22value%22,
		%22ParameterValue%22:%22red%22%
	%7D
	%22/TechUnits/sheet/onload/if.if/conditionA%22:%7B
		%22Parameters%22:%7B
			%22comptype%22:%22==%22,
			%22ignoreError%22:%22FALSE%22
		%7D
	%7D
	*/

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_SetValue, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pSetValue = Ov_StaticPtrCast(cshmi_SetValue, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_print(&strIterate, "%s%%22translationSource%%22:%%22%s%%22,", strIterate, ov_string_compare(pSetValue->v_translationSource, "")==OV_STRCMP_EQUAL?"":pSetValue->v_translationSource);

		if(ov_string_compare(pSetValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_ksVar);
		}else if(ov_string_compare(pSetValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_elemVar);
		}else if(ov_string_compare(pSetValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_globalVar);
		}else if(ov_string_compare(pSetValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pSetValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pSetValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pSetValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pSetValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pSetValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, NULL);
			ov_string_setvalue(&ParameterValue, NULL);
		}
		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%s%%22,", strIterate, ParameterName);
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%%22,", strIterate);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_memstack_lock();
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%s%%22,", strIterate, cshmi_downloadApplication_prepareURIencode(ParameterValue));
			ov_memstack_unlock();
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%%22,", strIterate);
		}
		if(ov_string_compare(pSetValue->v_translationSource, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterate, "%s%%22translationSource%%22:%%22%s%%22", strIterate, pSetValue->v_translationSource);
		}else{
			ov_string_print(&strIterate, "%s%%22translationSource%%22:%%22%%22", strIterate);
		}
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_SetConcatValue, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pSetConcatValue = Ov_StaticPtrCast(cshmi_SetConcatValue, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");

		if(ov_string_compare(pSetConcatValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_ksVar);
		}else if(ov_string_compare(pSetConcatValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_elemVar);
		}else if(ov_string_compare(pSetConcatValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_globalVar);
		}else if(ov_string_compare(pSetConcatValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pSetConcatValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pSetConcatValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pSetConcatValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pSetConcatValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, NULL);
			ov_string_setvalue(&ParameterValue, NULL);
		}
		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%s%%22,", strIterate, ParameterName);
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%%22,", strIterate);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_memstack_lock();
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%s%%22", strIterate, cshmi_downloadApplication_prepareURIencode(ParameterValue));
			ov_memstack_unlock();
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%%22", strIterate);
		}
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_SetMathValue, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pSetMathValue = Ov_StaticPtrCast(cshmi_SetMathValue, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");

		if(ov_string_compare(pSetMathValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_ksVar);
		}else if(ov_string_compare(pSetMathValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_elemVar);
		}else if(ov_string_compare(pSetMathValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_globalVar);
		}else if(ov_string_compare(pSetMathValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pSetMathValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pSetMathValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pSetMathValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pSetMathValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, NULL);
			ov_string_setvalue(&ParameterValue, NULL);
		}
		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%s%%22,", strIterate, ParameterName);
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%%22,", strIterate);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_memstack_lock();
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%s%%22", strIterate, cshmi_downloadApplication_prepareURIencode(ParameterValue));
			ov_memstack_unlock();
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%%22", strIterate);
		}
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_GetValue, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pGetValue = Ov_StaticPtrCast(cshmi_GetValue, pObj);
		if(ov_string_compare(pGetValue->v_ksVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "ksVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_ksVar);
		}else if(ov_string_compare(pGetValue->v_elemVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "elemVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_elemVar);
		}else if(ov_string_compare(pGetValue->v_globalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "globalVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_globalVar);
		}else if(ov_string_compare(pGetValue->v_persistentGlobalVar, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "persistentGlobalVar");
			ov_string_setvalue(&ParameterValue, pGetValue->v_persistentGlobalVar);
		}else if(ov_string_compare(pGetValue->v_OperatorInput, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "OperatorInput");
			ov_string_setvalue(&ParameterValue, pGetValue->v_OperatorInput);
		}else if(ov_string_compare(pGetValue->v_TemplateFBReferenceVariable, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBReferenceVariable");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateFBReferenceVariable);
		}else if(ov_string_compare(pGetValue->v_TemplateFBVariableReferenceName, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateFBVariableReferenceName");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateFBVariableReferenceName);
		}else if(ov_string_compare(pGetValue->v_TemplateConfigValues, "") != OV_STRCMP_EQUAL){
			ov_string_setvalue(&ParameterName, "TemplateConfigValues");
			ov_string_setvalue(&ParameterValue, pGetValue->v_TemplateConfigValues);
		}else{
			ov_string_setvalue(&ParameterName, "value");
			switch (pGetValue->v_value.value.vartype) {
				case OV_VT_STRING_PV:
					ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string);
					break;
				case OV_VT_BOOL_PV:
					ov_string_print(&ParameterValue, "%s", (pGetValue->v_value.value.valueunion.val_bool==TRUE?"TRUE":"FALSE"));
					break;
				case OV_VT_INT_PV:
					ov_string_print(&ParameterValue, "%i", pGetValue->v_value.value.valueunion.val_int);
					break;
				case OV_VT_UINT_PV:
					ov_string_print(&ParameterValue, "%u", pGetValue->v_value.value.valueunion.val_uint);
					break;
				case OV_VT_SINGLE_PV:
					ov_string_print(&ParameterValue, "%f", pGetValue->v_value.value.valueunion.val_single);
					break;
				case OV_VT_DOUBLE_PV:
					ov_string_print(&ParameterValue, "%lf", pGetValue->v_value.value.valueunion.val_double);
					break;
				case OV_VT_STRING_PV_VEC:
					if(pGetValue->v_value.value.valueunion.val_string_vec.veclen==0){
						ov_string_setvalue(&ParameterValue, NULL);
					}else if(pGetValue->v_value.value.valueunion.val_string_vec.veclen==1){
						ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[0]);
					}else{
						ov_string_setvalue(&ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[0]);
						for ( i = 1; i < pGetValue->v_value.value.valueunion.val_string_vec.veclen;i++){
							ov_string_print(&ParameterValue, "%s %s", ParameterValue, pGetValue->v_value.value.valueunion.val_string_vec.value[i]);
						}
					}
					break;
				case OV_VT_VOID:
					ov_string_setvalue(&ParameterValue, NULL);
					break;
				default:
					//The format of the value is not supported, so skip this precaching of the element
					continue;
			}
		}
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");

		if(ov_string_compare(ParameterName, NULL) != OV_STRCMP_EQUAL){
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%s%%22,", strIterate, ParameterName);
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterName%%22:%%22%%22,", strIterate);
		}
		if(ov_string_compare(ParameterValue, NULL) != OV_STRCMP_EQUAL){
			ov_memstack_lock();
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%s%%22", strIterate, cshmi_downloadApplication_prepareURIencode(ParameterValue));
			ov_memstack_unlock();
		}else{
			ov_string_print(&strIterate, "%s%%22ParameterValue%%22:%%22%%22", strIterate);
		}
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_ChildrenIterator, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pChildrenIterator = Ov_StaticPtrCast(cshmi_ChildrenIterator, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_print(&strIterate, "%s%%22ChildrenIteratorParameterChildrenType%%22:%%22%s%%22", strIterate, pChildrenIterator->v_ChildrenType);
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_IfThenElse, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pIfThenElse = Ov_StaticPtrCast(cshmi_IfThenElse, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_print(&strIterate, "%s%%22IfThenElseParameterAnycond%%22:%%22%s%%22", strIterate, (pIfThenElse->v_anycond==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Compare, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pCompare = Ov_StaticPtrCast(cshmi_Compare, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22comptype%%22:%%22%s%%22,", strIterate, pCompare->v_comptype);
		ov_string_print(&strIterate, "%s%%22ignoreError%%22:%%22%s%%22", strIterate, (pCompare->v_ignoreError==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_CompareIteratedChild, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pCompareIteratedChild = Ov_StaticPtrCast(cshmi_CompareIteratedChild, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");

		ov_string_print(&strIterate, "%s%%22comptype%%22:%%22%s%%22,", strIterate, pCompareIteratedChild->v_comptype);
		ov_string_print(&strIterate, "%s%%22childValue%%22:%%22%s%%22,", strIterate, pCompareIteratedChild->v_childValue);
		ov_string_print(&strIterate, "%s%%22ignoreError%%22:%%22%s%%22", strIterate, (pCompareIteratedChild->v_ignoreError==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_TimeEvent, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pTimeEvent = Ov_StaticPtrCast(cshmi_TimeEvent, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22cyctime%%22:%%22%f%%22", strIterate, pTimeEvent->v_cyctime);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_RoutePolyline, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pRoutePolyline = Ov_StaticPtrCast(cshmi_RoutePolyline, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22gridWidth%%22:%%22%f%%22,", strIterate, pRoutePolyline->v_gridWidth);
		ov_string_print(&strIterate, "%s%%22offset%%22:%%22%f%%22", strIterate, pRoutePolyline->v_offset);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_TranslationSource, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pTranslationSource = Ov_StaticPtrCast(cshmi_TranslationSource, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		if(pTranslationSource->v_translationMapping.veclen == 0){
			ov_string_setvalue(&temp, " ");
		}else if(pTranslationSource->v_translationMapping.veclen == 1){
			ov_memstack_lock();
			ov_string_print(&temp, "%%22%s%%22", cshmi_downloadApplication_prepareURIencode(pTranslationSource->v_translationMapping.value[0]));
			ov_memstack_unlock();
		}else{
			ov_memstack_lock();
			ov_string_print(&temp, "%%22%s%%22", cshmi_downloadApplication_prepareURIencode(pTranslationSource->v_translationMapping.value[0]));
			ov_memstack_unlock();
			for(i = 1; i < pTranslationSource->v_translationMapping.veclen;i++){
				ov_memstack_lock();
				ov_string_print(&temp, "%s,%%22%s%%22", temp, cshmi_downloadApplication_prepareURIencode(pTranslationSource->v_translationMapping.value[i]));
				ov_memstack_unlock();
			}
		}
		ov_string_print(&strIterate, "%s%%22TranslationMappingRaw%%22:%%5B%s%%5D", strIterate, temp);

		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");
		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_CreateObject, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pCreateObject = Ov_StaticPtrCast(cshmi_CreateObject, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		ov_string_print(&strIterate, "%s%%22autoRenameIfExists%%22:%%22%s%%22", strIterate, (pCreateObject->v_autoRenameIfExists==TRUE?"TRUE":"FALSE"));
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	elementInstantiated = FALSE;
	Ov_ForEachChild(ov_instantiation, pclass_cshmi_Vibrate, pObj){
#ifdef CSHMI_TIMING_DEBUG
		iterationcounter++;
#endif
		elementInstantiated = TRUE;
		pVibrate = Ov_StaticPtrCast(cshmi_Vibrate, pObj);
		ov_string_setvalue(&strIterate, "%22");
		ov_memstack_lock();
		ov_string_append(&strIterate, ov_path_getcanonicalpath(Ov_PtrUpCast(ov_object, pObj), 2));
		ov_memstack_unlock();
		ov_string_append(&strIterate, "%22:%7B");
		ov_string_append(&strIterate, "%22Parameters%22:%7B");
		if(pVibrate->v_pattern.veclen == 0){
			ov_string_setvalue(&temp, " ");
		}else if(pVibrate->v_pattern.veclen == 1){
			ov_memstack_lock();
			ov_string_print(&temp, "%u", pVibrate->v_pattern.value[0]);
			ov_memstack_unlock();
		}else{
			ov_memstack_lock();
			ov_string_print(&temp, "%u", pVibrate->v_pattern.value[0]);
			ov_memstack_unlock();
			for(i = 1; i < pVibrate->v_pattern.veclen;i++){
				ov_memstack_lock();
				ov_string_print(&temp, "%s,%u", temp, pVibrate->v_pattern.value[i]);
				ov_memstack_unlock();
			}
		}
		ov_string_print(&strIterate, "%s%%22pattern%%22:%%5B%s%%5D", strIterate, temp);
		ov_string_append(&strIterate, "%7D");
		ov_string_append(&strIterate, "%7D");

		if(Ov_GetNextChild(ov_instantiation, pObj) != NULL){
			ov_string_append(&strIterate, ",");
		}
		ov_string_append(&ResultListVec[ResultListIndex], strIterate);
	}
	if(elementInstantiated == TRUE){
		ResultListIndex++;
		if(elementIsfirst == TRUE){
			ov_string_append(&ResultFormat, "%s");
		}else{
			ov_string_append(&ResultFormat, ",%s");
		}
		elementIsfirst = FALSE;
	}

	//concat the result, manual for performance reasons (append is not cheap)
	result = ov_string_print(strResult, ResultFormat, *strResult, ResultListVec[0], ResultListVec[1], ResultListVec[2], ResultListVec[3], ResultListVec[4], ResultListVec[5], ResultListVec[6], ResultListVec[7], ResultListVec[8], ResultListVec[9], ResultListVec[10], ResultListVec[11], ResultListVec[12]);
	ov_string_setvalue(&ResultFormat, NULL);
	ov_string_setvalue(&ParameterName, NULL);
	ov_string_setvalue(&ParameterValue, NULL);
	ov_string_setvalue(&temp, NULL);

	ov_string_setvalue(&strIterate, NULL);
	for(i = 0;i < MAXACTIONENTRIES;i++){
		ov_string_setvalue(&ResultListVec[i], NULL);
	}

	return result;
}


/**
 * Tools:
 * http://meyerweb.com/eric/tools/dencoder/
 * http://jsonviewer.stack.hu/
 * http://jsonlint.com/
 */

/**
 *
 */
OV_DLLFNCEXPORT OV_STRING cshmi_downloadApplication_asJSON_get(
		OV_INSTPTR_cshmi_downloadApplication        UNUSED pThis
) {
	OV_INSTPTR_ov_object pTUcshmi = NULL;
	OV_INSTPTR_cshmi_Group pGroup = NULL;
	OV_INSTPTR_ov_object pGroupParent = NULL;
	OV_STRING returnString;
	OV_STRING strBaseKsPath = NULL;
	OV_STRING strElements = NULL;
	OV_STRING strActions = NULL;
	OV_STRING strChildList = NULL;
	OV_STRING pJSON;
	OV_UINT lenBaseKsPath = 0;
	OV_UINT lenElements = 0;
	OV_UINT lenActions = 0;
	OV_UINT lenChildList = 0;
	OV_RESULT result = OV_ERR_OK;

#ifdef CSHMI_TIMING_DEBUG
	OV_UINT lenSubChildList = 0;
	OV_TIME lasttime;
	OV_TIME thistime;
	OV_TIME_SPAN diff;

	functioncounter = 0;
	iterationcounter = 0;
	cntPrepareURIencode = 0;
	sumTimePrepareURIencode = 0;
#endif

	/**
	 * Umsetzungstabelle fr decodeURI
	 * " %22
	 * { %7B
	 * } %7D
	 * [ %5B
	 * ] %5D
	 * ( (
	 * ) )
	 * + +
	 */

	pTUcshmi = ov_path_getobjectpointer("/TechUnits/cshmi", 2);
	if(pTUcshmi == NULL || !Ov_CanCastTo(ov_domain, pTUcshmi)){
		return (OV_STRING) 0;
	}

	//todo
	//some static baseKsPath settings
	result = ov_string_setvalue(&strBaseKsPath, "%22baseKsPath%22:%7B%22/TechUnits/cshmi%22:%5B%5D,%22/TechUnits/cshmi/Templates%22:%5B%5D%7D,");
	lenBaseKsPath = ov_string_getlength(strBaseKsPath);

#ifdef CSHMI_TIMING_DEBUG
	ov_time_gettime(&lasttime);
#endif

	//Elements is a list of configured elements
	ov_string_setvalue(&strElements, "%22Elements%22:%7B");
	result = cshmi_downloadApplication_buildElementList(&strElements);
	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Elementlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
		ov_string_setvalue(&strBaseKsPath, NULL);
		ov_string_setvalue(&strElements, NULL);
		return (OV_STRING) 0;
	}else{
		ov_string_append(&strElements, "%7D,");
	}
	lenElements = ov_string_getlength(strElements);

#ifdef CSHMI_TIMING_DEBUG
	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Time: %s", ov_time_timetoascii_local(&thistime));
	ov_logfile_debug("Elements    : %s (%u Bytes, %u function calls, %u iterations)", ov_time_timespantoascii(&diff), lenElements, functioncounter, iterationcounter);
	ov_time_gettime(&lasttime);
	functioncounter = 0;
	iterationcounter = 0;
#endif

	//Actions is a list of events/actions/conditions, set/get stores the result only
	ov_string_setvalue(&strActions, "%22Actions%22:%7B");
	result = cshmi_downloadApplication_buildActionList(&strActions);

	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Actionlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
		ov_string_setvalue(&strBaseKsPath, NULL);
		ov_string_setvalue(&strElements, NULL);
		ov_string_setvalue(&strActions, NULL);
		return (OV_STRING) 0;
	}else{
		ov_string_append(&strActions, "%7D,");
	}
	lenActions = ov_string_getlength(strActions);

#ifdef CSHMI_TIMING_DEBUG
	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Actions     : %s (%u Bytes, %u function calls, %u iterations)", ov_time_timespantoascii(&diff), lenActions, functioncounter, iterationcounter);
	ov_time_gettime(&lasttime);
	functioncounter = 0;
	iterationcounter = 0;
#endif

	//ChildList is a list of ov_containment
	ov_string_setvalue(&strChildList, "%22ChildList%22:%7B");
	result = cshmi_downloadApplication_buildChildList(pTUcshmi, &strChildList, TRUE);

#ifdef CSHMI_TIMING_DEBUG
	lenSubChildList = ov_string_getlength(strChildList);

	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Childlist CS: %s (%u Bytes, %u function calls, %u iterations)", ov_time_timespantoascii(&diff), lenSubChildList, functioncounter, iterationcounter);
	ov_time_gettime(&lasttime);
	functioncounter = 0;
	iterationcounter = 0;
#endif

	//todo 2mbyte mb scheint fr den engineering testcase zu klein. also vergrern
	//ndern in memstack, also heap
	if(Ov_Fail(result)){
		ov_logfile_debug("%d:%s Error building Childlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
		ov_string_setvalue(&strBaseKsPath, NULL);
		ov_string_setvalue(&strElements, NULL);
		ov_string_setvalue(&strActions, NULL);
		ov_string_setvalue(&strChildList, NULL);
		return (OV_STRING) 0;
	}
	//check for other groups outside of /TechUnits/cshmi
	Ov_ForEachChildEx(ov_instantiation, pclass_cshmi_Group, pGroup, cshmi_Group){
		pGroupParent = Ov_PtrUpCast(ov_object, Ov_GetParent(ov_containment, pGroup));
		if(!Ov_CanCastTo(cshmi_Object, pGroupParent) && pGroupParent != pTUcshmi){
			result = cshmi_downloadApplication_buildChildList(Ov_PtrUpCast(ov_object, pGroup), &strChildList, FALSE);
			if(Ov_Fail(result)){
				ov_logfile_debug("%d:%s Error building Childlist: %s", __LINE__, __FILE__, ov_result_getresulttext(result));
				ov_string_setvalue(&strBaseKsPath, NULL);
				ov_string_setvalue(&strElements, NULL);
				ov_string_setvalue(&strActions, NULL);
				ov_string_setvalue(&strChildList, NULL);
				return (OV_STRING) 0;
			}
		}
	}
	ov_string_append(&strChildList, "%7D");

	lenChildList = ov_string_getlength(strChildList);

#ifdef CSHMI_TIMING_DEBUG
	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("Childlist TU: %s (%u Bytes, %u function calls, %u iterations)", ov_time_timespantoascii(&diff), lenChildList-lenSubChildList, functioncounter, iterationcounter);
	ov_time_gettime(&lasttime);
	functioncounter = 0;
	iterationcounter = 0;
#endif

	//we need space for all 4 strings, two times 3 Bytes and a null byte terminator
	pJSON = (OV_STRING) ov_memstack_alloc(lenBaseKsPath+lenElements+lenActions+lenChildList+7);

	if (!pJSON){
		ov_logfile_debug("%d:%s Error reserving memory for concatting result: MEMSTACK full", __LINE__, __FILE__);
		ov_string_setvalue(&strBaseKsPath, NULL);
		ov_string_setvalue(&strActions, NULL);
		ov_string_setvalue(&strChildList, NULL);
		ov_string_setvalue(&strElements, NULL);
		return (OV_STRING) 0;
	}

	returnString = pJSON;
	//open JSON Element, concat Strings and close JSON Element
	strncpy(pJSON, "%7B", 3);
	pJSON = pJSON + 3;
	strncpy(pJSON, strBaseKsPath, lenBaseKsPath);
	pJSON = pJSON + lenBaseKsPath;
	strncpy(pJSON, strElements, lenElements);
	pJSON = pJSON + lenElements;
	strncpy(pJSON, strActions, lenActions);
	pJSON = pJSON + lenActions;
	strncpy(pJSON, strChildList, lenChildList);
	pJSON = pJSON + lenChildList;
	strncpy(pJSON, "%7D", 4);

	ov_string_setvalue(&strBaseKsPath, NULL);
	ov_string_setvalue(&strActions, NULL);
	ov_string_setvalue(&strChildList, NULL);
	ov_string_setvalue(&strElements, NULL);

#ifdef CSHMI_TIMING_DEBUG
	ov_time_gettime(&thistime);
	ov_time_diff(&diff, &thistime, &lasttime);
	ov_logfile_debug("strconcat   : %s", ov_time_timespantoascii(&diff));
	Ov_DoubleToTimeSpan(sumTimePrepareURIencode, diff);
	ov_logfile_debug("prepURIencd : %s", ov_time_timespantoascii(&diff));
	ov_logfile_debug("count prepareURIencode: %u", cntPrepareURIencode);
	cntPrepareURIencode = 0;

	ov_time_gettime(&lasttime);
#endif

	return returnString;
}
