#******************************************************************************
#*
#*   FILE
#*   ----
#*   msvc.mk - Makefile fuer die Anwender-Bibliothek
#******************************************************************************
#*
#*   This file is generated by the 'fb_makmak' command
#*
#******************************************************************************

#   Plattform
#   ---------

SYSTEM = NT
SYSDIR = nt

COMPILER = MSVC

#	Filename conventions
#	--------------------
_C   = .c
_OBJ = .obj
_LIB = .lib
_DLL = .dll
_EXE = .exe
_RES = .res

#	Include generic part
#	--------------------
include ../generic.mk

# Oncrpc
# ------
ONCRPC_DIR	= $(BASE_DIR)oncrpc

# Libraries
# ---------
OVLIBS = $(OV_LIBS_DIR)libov_msvc$(_LIB) $(OV_LIBS_DIR)libovks_msvc$(_LIB)
FBLIBS = $(FBS_LIBS_DIR)fb_msvc$(_LIB)
ADD_LIBS = ../../../ksapi/build/nt/ksapi$(_LIB) ../../../msgsys/build/nt/msgsys$(_LIB)

all: $(TARGETS)

#	Compiler
#	--------

OV_CODEGEN_EXE = $(BIN_DIR)ov_codegen$(_EXE)
CC              = cl
CC_FLAGS        = /W3 /c 
CC_DEFINES      = $(DEFINES) /DOV_COMPILE_LIBRARY_$(LIBRARY)
CC_INCLUDES     = $(INCLUDES) /I$(ONCRPC_DIR) /I.
COMPILE_C		= $(CC) $(CC_FLAGS) /TC $(CC_DEFINES) $(CC_INCLUDES) -c
LD              = link /DLL

#   Rules
#   -----
$(_C)$(_OBJ):
	$(COMPILE_C) -o$@ $<

.ovm$(_C):
	$(OV_CODEGEN_EXE) -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(ksapi_MODEL_DIR) -I $(msgsys_MODEL_DIR) -f $(subst /,\\, $<) -l $(notdir $(basename $<))

.ovm.h: 
	$(OV_CODEGEN_EXE) -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(ksapi_MODEL_DIR) -I $(msgsys_MODEL_DIR) -f $(subst /,\\, $<) -l $(notdir $(basename $<))

ov.h : $(ACPLT_OV_INCLUDE_DIR)ov.ovm
	$(OV_CODEGEN_EXE) -f $<

fb.h : $(FBS_INCLUDE_DIR)fb.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR)

ksapi.h : $(ksapi_MODEL_DIR)ksapi.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(ksapi_MODEL_DIR)

msgsys.h : $(msgsys_MODEL_DIR)msgsys.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(ksapi_MODEL_DIR)
	
msgreceiver.h : $(MODEL_DIR)msgreceiver.ovm
	$(OV_CODEGEN_EXE) -f $< -I $(ACPLT_OV_INCLUDE_DIR) -I $(FBS_INCLUDE_DIR) -I $(ksapi_MODEL_DIR) -I $(msgsys_MODEL_DIR)
	
$(USERLIB_LIB) : $(USERLIB_DLL)

$(USERLIB_DLL) : $(USERLIB_OBJ)
	$(LD) $(USERLIB_OBJ) $(ADD_LIBS) $(FBLIBS) $(OVLIBS) $(LINK_FLAGS) /OUT:$@
	@copy $(USERLIB_DLL) $(subst /,\\, $(USERLIB_DIR))
#	Aufraeumen
#	----------

clean:
	-@del *$(_C) *.h *.x *.bak *.map *$(_LIB) *$(_DLL) *$(_OBJ) *$(_RES) respfile
