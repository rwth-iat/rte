
/******************************************************************************
*
*   FILE
*   ----
*   ClientHandler.c
*
*   History
*   -------
*   2013-01-15   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_ksbase
#define OV_COMPILE_LIBRARY_ksbase
#endif


#include "ksbase.h"
#include "libov/ov_macros.h"
#include "ks_logfile.h"
#include <stdio.h>



OV_DLLFNCEXPORT OV_STRING ksbase_ClientHandler_sourceAdr_get(
    OV_INSTPTR_ksbase_ClientHandler          pobj
) {
    return pobj->v_sourceAdr;
}

OV_DLLFNCEXPORT OV_STRING ksbase_ClientHandler_ovticket_get(
    OV_INSTPTR_ksbase_ClientHandler          pobj
) {
    return pobj->v_ovticket;
}

OV_DLLFNCEXPORT OV_INT ksbase_ClientHandler_receivedCalls_get(
    OV_INSTPTR_ksbase_ClientHandler          pobj
) {
    return pobj->v_receivedCalls;
}
/**
 * set actimode to 0 as a default.
 * When a packet is received the Channel calls the ClientHandlers HendleRequest function. Only ion some cases a ClientHandler needs to act proactively.
 * Therefore the typemethod can be implemented.
 */
OV_DLLFNCEXPORT void ksbase_ClientHandler_startup(
	OV_INSTPTR_ov_object 	pobj
) {
    /*
    *   local variables
    */
	OV_INSTPTR_ksbase_ClientHandler this = Ov_StaticPtrCast(ksbase_ClientHandler, pobj);
    /* do what the base class does first */
    ov_object_startup(pobj);

    /* do what */
    this->v_actimode = 0;

    return;
}


OV_DLLFNCEXPORT void ksbase_ClientHandler_shutdown(
	OV_INSTPTR_ov_object 	pobj
) {
    /*
    *   local variables
    */

    /* do what */

    if(pobj->v_objectstate & OV_OS_STARTED)
    {
    	/* set the object's state to "shut down" */
    	ov_object_shutdown(pobj);
    	/*destroy the object. this object may not be created at next startup*/
		Ov_DeleteObject(pobj);
    }
    return;
}

/**
 * This function is called by a channel object when there is data for this ClientHandler.
 * @param OV_INSTPTR_ksbase_ClientHandler this: a pointer to the ClientHandler itself
 * @param KS_DATAPACKET* dataReceived: the received data the ClientHandler has to work with. The calling Channel will set this to its inData variable
 * @param KS_DATAPACKET* answer: the answer generated by the ClientHandler. The calling Channel  will set this to its outData variable
 */
OV_DLLFNCEXPORT OV_RESULT ksbase_ClientHandler_HandleRequest(
	OV_INSTPTR_ksbase_ClientHandler this,
	KS_DATAPACKET* dataReceived,
	KS_DATAPACKET* answer
)	{
#if LOG_KS || LOG_KS_DEBUG
	char temp [9];
	OV_UINT i = 0;
#endif

	KS_logfile_warning(("Empty HandleRequest function. No functionality implemented for ClientHandler %s of class %s", this->v_identifier, Ov_GetParent(ov_instantiation, this)->v_identifier));

#if LOG_KS || LOG_KS_DEBUG
	KS_logfile_debug(("ClientHandler: %s dataReceived first 64 bytes:\n"));

	for(i=0; i < 8; i++)
	{
		snprintf(temp, 9, (char*)&(dataReceived->data[i*8]));
		fprintf(stdout, "\t%#08x %08x %s\n", (unsigned int) dataReceived->data[i*8], (unsigned int) dataReceived->data[i*8+4], temp);
	}
#endif
	return OV_ERR_OK;
}

