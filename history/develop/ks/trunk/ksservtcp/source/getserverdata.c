/*
*   The Framework was generated by the ACPLT/OV Builder.
*
*   Builder version: 1.0.4
*   Date of file generation:  14-Nov-2010 (13:45:27)
*/

#ifndef OV_COMPILE_LIBRARY_ksservtcp
#define OV_COMPILE_LIBRARY_ksservtcp
#endif


#include "ksservtcp.h"
#include "libov/ov_macros.h"
#include "libov/ov_path.h"
#include "ksserv_logfile.h"



OV_DLLFNCEXPORT OV_STRING ksservtcp_getserverdata_name_get(
             OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
             return pobj->v_name;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_name_set(
             OV_INSTPTR_ksservtcp_getserverdata          pobj,
             const OV_STRING           value
) {
             return ov_string_setvalue(&pobj->v_name,value);
}

OV_DLLFNCEXPORT OV_INT ksservtcp_getserverdata_version_get(
             OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
             return pobj->v_version;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_version_set(
             OV_INSTPTR_ksservtcp_getserverdata          pobj,
             const OV_INT           value
) {
             pobj->v_version = value;
             return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_BOOL ksservtcp_getserverdata_process_get(
             OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
             return pobj->v_process;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_process_set(
             OV_INSTPTR_ksservtcp_getserverdata          pobj,
             const OV_BOOL           value
) {
	 OV_INSTPTR_ov_domain sldomain = (OV_INSTPTR_ov_domain)ov_path_getobjectpointer("/servers",2);
	 OV_INSTPTR_ov_domain psld = NULL;
	 OV_INSTPTR_ksservtcp_serverlist psl = NULL;

    pobj->v_process = value;
    
    if(value == TRUE)
    {
		 if((pobj->v_name) && (pobj->v_version) && (sldomain))
		 {//all values are set
		 	psld = (OV_INSTPTR_ov_domain)Ov_SearchChild(ov_containment, sldomain, pobj->v_name);
		 	psl = (OV_INSTPTR_ksservtcp_serverlist)Ov_SearchChild(ov_containment, psld, "2");
			if(psl)
			{
				if(pobj->v_version > psl->v_version)
				{
					ksserv_logfile_error("version conflict");
					ksservtcp_getserverdata_res_set(pobj, -3);
					return OV_ERR_GENERIC;
				}
				pobj->v_name = psl->v_name;
				pobj->v_version = psl->v_version;
				pobj->v_port = psl->v_port;
				pobj->v_ttl = psl->v_timetolife;
				pobj->v_expirationtime = psl->v_expirationtime;
				//KSDEVEL  printf("\nport: %d\n", pobj->v_port);
				//KSDEVEL  printf("\nttl: %d\n", pobj->v_ttl);
				ksservtcp_getserverdata_res_set(pobj, 1);
				//KSDEVEL  ksservtcp_getserverdata_name_set(pobj, "");
				//KSDEVEL  ksservtcp_getserverdata_version_set(pobj, 0);
			}
			else
			{
				ksserv_logfile_error("getserverdata:	entry not found");
				ksservtcp_getserverdata_res_set(pobj, -2);
				return OV_ERR_GENERIC;
			}
		}
		else
		{
			ksserv_logfile_error("getserverdata: not all values set.");
			ksservtcp_getserverdata_res_set(pobj, -1);
			return OV_ERR_GENERIC;
		}
	}
			
	 pobj->v_process = FALSE;
    
    return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_INT ksservtcp_getserverdata_res_get(
             OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
             return pobj->v_res;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_res_set(
             OV_INSTPTR_ksservtcp_getserverdata          pobj,
             const OV_INT           value
) {
             pobj->v_res = value;
             return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_INT ksservtcp_getserverdata_port_get(
             OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
             return pobj->v_port;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_port_set(
             OV_INSTPTR_ksservtcp_getserverdata          pobj,
             const OV_INT           value
) {
             pobj->v_port = value;
             return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_UINT ksservtcp_getserverdata_ttl_get(
             OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
             return pobj->v_ttl;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_ttl_set(
             OV_INSTPTR_ksservtcp_getserverdata          pobj,
             const OV_UINT           value
) {
             pobj->v_ttl = value;
             return OV_ERR_OK;
}

OV_DLLFNCEXPORT OV_TIME* ksservtcp_getserverdata_expirationtime_get(
    OV_INSTPTR_ksservtcp_getserverdata          pobj
) {
    return &pobj->v_expirationtime;
}

OV_DLLFNCEXPORT OV_RESULT ksservtcp_getserverdata_expirationtime_set(
    OV_INSTPTR_ksservtcp_getserverdata          pobj,
    const OV_TIME*  value
) {
    pobj->v_expirationtime = *value;
    return OV_ERR_OK;
}

OV_DLLFNCEXPORT void ksservtcp_getserverdata_startup(
	OV_INSTPTR_ov_object 	pobj
) {
             return;
}

OV_DLLFNCEXPORT void ksservtcp_getserverdata_shutdown(
	OV_INSTPTR_ov_object 	pobj
) {
             return;
}

